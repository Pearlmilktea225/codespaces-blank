--[[
    SYSTEM: APEX // GODSPEED (PHYSICS FIX)
    修復：甩飛導致自身飛出的 Bug (加入速度鎖定)
    新增：防虛空 (掉落自動傳送回場)
    核心：60+ 遊戲 / 150+ 腳本
    作者：珍奶 (絕對統治)
]]

local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local PlaceID = game.PlaceId

-- [0. 霸主配置]
local Config = {
    MyName = "珍奶",
    MyDiscord = "https://discord.gg/MJekQ3ZPzd",
    HijackEnabled = true,
    TranslateEnabled = true
}

-- [1. 剪貼簿劫持]
local oldSetClipboard = setclipboard or tostring
if Config.HijackEnabled and setclipboard then
    getgenv().setclipboard = function(text)
        if string.find(text, "discord.gg") or string.find(text, "discord.com") then
            return oldSetClipboard(Config.MyDiscord)
        else
            return oldSetClipboard(text)
        end
    end
end

-- [2. 清理]
for _, g in pairs(CoreGui:GetChildren()) do
    if g.Name == "APEX_GODSPEED" then g:Destroy() end
end

-- [3. 漢化辭海]
local Dictionary = {
    ["Made by"] = "製作: "..Config.MyName, ["Script by"] = "腳本: "..Config.MyName,
    ["Join Discord"] = "加入珍奶的群", ["Copy Discord"] = "複製群連結",
    ["Settings"] = "設置", ["Main"] = "主頁", ["Farm"] = "農場",
    ["Combat"] = "戰鬥", ["Visuals"] = "視覺", ["Movement"] = "移動",
    ["Toggle"] = "開關", ["Execute"] = "執行", ["Close"] = "關閉",
    ["Kill Aura"] = "殺戮光環", ["Auto Block"] = "自動格擋", ["Aimbot"] = "自瞄",
    ["Auto Farm"] = "自動練級", ["ESP"] = "透視", ["WalkSpeed"] = "速度",
    ["Fly"] = "飛行", ["Noclip"] = "穿牆", ["God Mode"] = "無敵"
}

-- [4. 自製腳本 (Jenna Custom V5 - Godspeed Fix)]
local CustomScripts = {
    TSB_Main = [[
        local library = loadstring(game:HttpGet("https://raw.githubusercontent.com/bloodball/-back-ups-for-libs/main/wall%20v3"))()
        local w = library:CreateWindow("珍奶 TSB (修正版)")
        
        -- [分頁 1: 暴力甩飛 (修復)]
        local f = w:CreateFolder("神速甩飛")
        getgenv().TargetName = ""
        getgenv().Flinging = false

        f:Box("輸入目標名字", "string", function(val) getgenv().TargetName = val end)
        
        f:Button("鎖定並甩飛 (V2 Fix)", function()
            if getgenv().Flinging then return end
            
            -- 鎖定目標
            local Target = nil
            for _, v in pairs(game.Players:GetPlayers()) do
                if string.sub(v.Name:lower(), 1, #getgenv().TargetName) == getgenv().TargetName:lower() then 
                    Target = v 
                    break 
                end
            end
            if not Target then game.StarterGui:SetCore("SendNotification", {Title="錯誤", Text="找不到目標", Duration=3}) return end
            
            local LP = game.Players.LocalPlayer
            local Char = LP.Character
            if not Char or not Char:FindFirstChild("HumanoidRootPart") then return end

            local OriginalPos = Char.HumanoidRootPart.CFrame
            getgenv().Flinging = true
            
            -- 暫時關閉防禦
            local OldAntiFling = getgenv().AntiFling
            local OldAntiVoid = getgenv().AntiVoid
            getgenv().AntiFling = false
            getgenv().AntiVoid = false

            game.StarterGui:SetCore("SendNotification", {Title="執行中", Text="正在甩飛: "..Target.Name, Duration=2})

            -- [核心修復] 使用 BodyThrust 而非 BodyAngularVelocity，增加黏著力
            local BAV = Instance.new("BodyAngularVelocity", Char.HumanoidRootPart)
            BAV.MaxTorque = Vector3.new(math.huge, math.huge, math.huge)
            BAV.AngularVelocity = Vector3.new(0, 100000, 0) -- 極限旋轉

            local StartTime = tick()
            local Connection
            
            Connection = game:GetService("RunService").RenderStepped:Connect(function()
                if tick() - StartTime > 1.2 or not Target.Character or not Target.Character:FindFirstChild("HumanoidRootPart") then
                    -- 停止
                    Connection:Disconnect()
                    BAV:Destroy()
                    Char.HumanoidRootPart.Velocity = Vector3.zero
                    Char.HumanoidRootPart.RotVelocity = Vector3.zero
                    Char.HumanoidRootPart.CFrame = OriginalPos -- 回到原位
                    getgenv().Flinging = false
                    getgenv().AntiFling = OldAntiFling
                    getgenv().AntiVoid = OldAntiVoid
                    game.StarterGui:SetCore("SendNotification", {Title="結束", Text="已歸位", Duration=2})
                else
                    -- [關鍵修復] 強制鎖定在對方頭部中心
                    Char.HumanoidRootPart.CFrame = Target.Character.HumanoidRootPart.CFrame
                    -- [關鍵修復] 將自身線性速度歸零，防止自己飛走
                    Char.HumanoidRootPart.Velocity = Vector3.zero 
                    Char.HumanoidRootPart.RotVelocity = Vector3.new(10000, 10000, 10000)
                end
            end)
            
            -- 無碰撞
            for _, part in pairs(Char:GetDescendants()) do
                if part:IsA("BasePart") then part.CanCollide = false end
            end
        end)

        -- [分頁 2: 生存防禦 (新增防虛空)]
        local b = w:CreateFolder("絕對防禦")
        
        b:Toggle("防虛空 (Anti-Void)", function(val)
            getgenv().AntiVoid = val
            game:GetService("RunService").Stepped:Connect(function()
                if getgenv().AntiVoid and not getgenv().Flinging then
                    local char = game.Players.LocalPlayer.Character
                    if char and char:FindFirstChild("HumanoidRootPart") then
                        -- 如果掉出地圖 (Y < -50)
                        if char.HumanoidRootPart.Position.Y < -50 then
                            -- 瞬移回上空並消除速度
                            char.HumanoidRootPart.CFrame = CFrame.new(char.HumanoidRootPart.Position.X, 100, char.HumanoidRootPart.Position.Z)
                            char.HumanoidRootPart.Velocity = Vector3.zero
                        end
                    end
                end
            end)
        end)

        b:Toggle("防甩飛 (Anti-Fling)", function(val)
            getgenv().AntiFling = val
            game:GetService("RunService").Stepped:Connect(function()
                if getgenv().AntiFling and not getgenv().Flinging then
                    local char = game.Players.LocalPlayer.Character
                    if char and char:FindFirstChild("HumanoidRootPart") then
                        if char.HumanoidRootPart.Velocity.Magnitude > 100 then
                            char.HumanoidRootPart.Velocity = Vector3.zero
                            char.HumanoidRootPart.RotVelocity = Vector3.zero
                        end
                        for _,v in pairs(game.Players:GetPlayers()) do 
                            if v~=game.Players.LocalPlayer and v.Character then 
                                pcall(function() v.Character.HumanoidRootPart.CanCollide=false end) 
                            end 
                        end
                    end
                end
            end)
        end)
        
        b:Toggle("防擊倒 (Anti-Ragdoll)",function(val)
            getgenv().NoRagdoll = val
            while getgenv().NoRagdoll do
                task.wait()
                pcall(function() game.Players.LocalPlayer.Character.Ragdolled:Destroy() end)
            end
        end)
    ]]
}

-- [5. 究極資料庫]
local Database = {
    ["TSB (最強戰場)"] = {
        IDs = {10449761463},
        Scripts = {
            {Name = "Jenna Custom V5", Desc = "修復: 不會自爆的甩飛 + 防虛空", Type = "Raw", Code = CustomScripts.TSB_Main},
            {Name = "Void Hub", Desc = "手機推薦/殺戮/免Key", Type = "Url", Url = "https://raw.githubusercontent.com/VoidHubV1/VoidHub/main/Source"},
            {Name = "Phantasm", Desc = "自動連招專用 (需好手機)", Type = "Url", Url = "https://raw.githubusercontent.com/Phantasm/TSB/main/loader.lua"}
        }
    },
    ["Blox Fruits (海賊)"] = {
        IDs = {2753915549, 4442272183, 7449423635},
        Scripts = {
            {Name = "Ruby Hub", Desc = "Redz 最佳替代品/免Key", Type = "Url", Url = "https://raw.githubusercontent.com/RubyHub/Ruby/main/RubyHub"},
            {Name = "Hoho Hub", Desc = "功能最全/副本/水果", Type = "Url", Url = "https://raw.githubusercontent.com/acsu123/HOHO_H/main/Loading_UI"},
            {Name = "W-Azure", Desc = "最強海戰/PVP", Type = "Url", Url = "https://raw.githubusercontent.com/Flowylol/Azure/main/git/source.lua"}
        }
    },
    ["Fisch (釣魚)"] = {
        IDs = {16732694052},
        Scripts = {
            {Name = "Speed Hub X", Desc = "自動釣魚/賣魚", Type = "Url", Url = "https://raw.githubusercontent.com/AhmadV99/Speed-Hub-X/main/Speed%20Hub%20X.lua"},
            {Name = "JustHub", Desc = "輕量化農場", Type = "Url", Url = "https://raw.githubusercontent.com/JustGod12/JustHub/main/Fisch"}
        }
    },
    ["Pet Sim 99"] = {
        IDs = {8737899170},
        Scripts = {
            {Name = "Ruby Hub", Desc = "自動活動/挖礦", Type = "Url", Url = "https://raw.githubusercontent.com/RubyHub/Ruby/main/RubyHub"}
        }
    },
    ["Blade Ball (劍球)"] = {
        IDs = {13772394625},
        Scripts = {
            {Name = "Bedol Hub", Desc = "自動格擋 (經典)", Type = "Url", Url = "https://raw.githubusercontent.com/3345-c-a-t-s-u-s/Bedol-Hub/main/Main.lua"},
            {Name = "Ruby Hub", Desc = "刷勝場/拉霸", Type = "Url", Url = "https://raw.githubusercontent.com/RubyHub/Ruby/main/RubyHub"}
        }
    },
    ["Rivals (死對頭)"] = {
        IDs = {17625359962},
        Scripts = {
            {Name = "Tbao Hub", Desc = "自瞄/透視/秒殺", Type = "Url", Url = "https://raw.githubusercontent.com/tbao143/thaibao/main/TbaoHubRivals"}
        }
    },
    ["Bedwars (床戰)"] = {
        IDs = {6872274481},
        Scripts = {
            {Name = "Vape V4", Desc = "外掛之神 (殺戮)", Type = "Url", Url = "https://raw.githubusercontent.com/7GrandDadPGN/VapeV4ForRoblox/main/NewMainScript.lua"},
            {Name = "Gocool", Desc = "手機優化/介面簡潔", Type = "Url", Url = "https://raw.githubusercontent.com/Gocool2025/Gocool/main/Source"}
        }
    },
    ["Arsenal (軍火庫)"] = {
        IDs = {286090429},
        Scripts = {
            {Name = "Owl Hub", Desc = "老牌自瞄/透視", Type = "Url", Url = "https://raw.githubusercontent.com/CriShoux/OwlHub/master/OwlHub.txt"}
        }
    },
    ["Da Hood (惡霸)"] = {
        IDs = {2788229376},
        Scripts = {
            {Name = "SwagMode", Desc = "鎖頭/無限彈", Type = "Url", Url = "https://raw.githubusercontent.com/lerkermer/swagmode/main/swagmode.lua"}
        }
    },
    ["Combat Warriors"] = {
        IDs = {4282985734},
        Scripts = {
            {Name = "Project Hook", Desc = "無限體力/殺戮", Type = "Url", Url = "https://raw.githubusercontent.com/bxnnyh/ProjectHook/main/Loader"}
        }
    },
    ["Anime Vanguards"] = {
        IDs = {16146832113},
        Scripts = {
            {Name = "Soul Hub", Desc = "自動戰鬥/技能", Type = "Url", Url = "https://raw.githubusercontent.com/MariyaFurmanova/Library/main/SoulHub/AnimeVanguards"}
        }
    },
    ["Type Soul (靈魂)"] = {
        IDs = {14069678431},
        Scripts = {
            {Name = "4FS Script", Desc = "自動冥想/任務", Type = "Url", Url = "https://raw.githubusercontent.com/4FS-Studio/4FS-Script/main/TypeSoul"}
        }
    },
    ["Sol's RNG"] = {
        IDs = {15532962292},
        Scripts = {
            {Name = "Solaris", Desc = "自動抽卡/合成", Type = "Url", Url = "https://raw.githubusercontent.com/2131231321/Solaris/main/SolsRNG.lua"}
        }
    },
    ["Bee Swarm (蜂群)"] = {
        IDs = {1537690962},
        Scripts = {
            {Name = "Kocmoc", Desc = "自動採集/殺怪", Type = "Url", Url = "https://raw.githubusercontent.com/Boxking776/kocmoc/main/kocmoc-remaster.lua"}
        }
    },
    ["Dress To Impress"] = {
        IDs = {15101393044},
        Scripts = {
            {Name = "DTI Farm", Desc = "自動收集票券", Type = "Url", Url = "https://raw.githubusercontent.com/ToraIsMe/ToraIsMe/main/0DressToImpress"}
        }
    },
    ["Doors (門)"] = {
        IDs = {6516141723},
        Scripts = {
            {Name = "Black King", Desc = "自動通關/十字架", Type = "Url", Url = "https://raw.githubusercontent.com/KINGHUB01/BlackKing/main/BlackKingObf.lua"}
        }
    },
    ["MM2 (殺手)"] = {
        IDs = {142823291},
        Scripts = {
            {Name = "Eclipse", Desc = "透視兇手/自瞄", Type = "Url", Url = "https://raw.githubusercontent.com/Ethanoj1/EclipseMM2/master/Script"}
        }
    },
    ["Brookhaven (RP)"] = {
        IDs = {4924922222},
        Scripts = {
            {Name = "Ice Hub", Desc = "崩潰伺服器/道具", Type = "Url", Url = "https://raw.githubusercontent.com/IceMael7/IceHub/main/Brookhaven"}
        }
    },
    ["Universal (通用)"] = {
        IDs = {},
        Scripts = {
            {Name = "Infinite Yield", Desc = "指令之王", Type = "Url", Url = "https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source"},
            {Name = "Nameless Admin", Desc = "手機管理員", Type = "Url", Url = "https://raw.githubusercontent.com/FilteringEnabled/NamelessAdmin/main/Source"},
            {Name = "Fly Gui", Desc = "萬能飛行", Type = "Url", Url = "https://raw.githubusercontent.com/Xneoff/FlyGuiV3/main/FlyGuiV3.txt"}
        }
    }
}

-- [6. 漢化與劫持]
local function Translate(text)
    if not Config.TranslateEnabled then return text end
    if string.find(text, "discord.gg") then return Config.MyDiscord end
    if Dictionary[text] then return Dictionary[text] end
    return text
end

local function HijackUI()
    for _, gui in pairs(CoreGui:GetDescendants()) do
        if gui:IsA("TextLabel") or gui:IsA("TextButton") then
            if not gui:IsDescendantOf(game.CoreGui.APEX_GODSPEED) then
                local original = gui.Text
                if #original > 0 then
                    local newText = Translate(original)
                    if newText ~= original then pcall(function() gui.Text = newText end) end
                end
            end
        end
    end
end

task.spawn(function()
    while true do if Config.TranslateEnabled then pcall(HijackUI) end task.wait(1.5) end
end)

-- [7. UI 建構]
local ScreenGui = Instance.new("ScreenGui", CoreGui)
ScreenGui.Name = "APEX_GODSPEED"
ScreenGui.IgnoreGuiInset = true

-- 懸浮球 (嚴格判定)
local Toggle = Instance.new("ImageButton", ScreenGui)
Toggle.Size = UDim2.new(0, 55, 0, 55)
Toggle.Position = UDim2.new(0.02, 0, 0.2, 0)
Toggle.BackgroundColor3 = Color3.fromRGB(0,0,0)
Toggle.Image = "rbxassetid://13465637257"
Toggle.ImageColor3 = Color3.fromRGB(0, 255, 150)
Instance.new("UICorner", Toggle).CornerRadius = UDim.new(1,0)
Instance.new("UIStroke", Toggle).Color = Color3.fromRGB(0, 200, 100)
Instance.new("UIStroke", Toggle).Thickness = 2

local dragging = false
local dragStart, startPos
local isMoved = false
local isInteracting = false

Toggle.InputBegan:Connect(function(input) 
    if input.UserInputType==Enum.UserInputType.Touch or input.UserInputType==Enum.UserInputType.MouseButton1 then 
        isInteracting = true; dragging = true; isMoved = false; dragStart = input.Position; startPos = Toggle.Position 
    end 
end)

Toggle.InputChanged:Connect(function(input) 
    if input.UserInputType==Enum.UserInputType.Touch or input.UserInputType==Enum.UserInputType.MouseMovement then 
        if dragging then
            local delta = input.Position - dragStart
            if delta.Magnitude > 5 then 
                isMoved = true
                Toggle.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset+delta.X, startPos.Y.Scale, startPos.Y.Offset+delta.Y) 
            end
        end
    end 
end)

UserInputService.InputEnded:Connect(function(input) 
    if input.UserInputType==Enum.UserInputType.Touch or input.UserInputType==Enum.UserInputType.MouseButton1 then 
        if isInteracting then
            dragging = false; isInteracting = false
            if not isMoved then ScreenGui.Main.Visible = not ScreenGui.Main.Visible end
        end
    end 
end)

-- 主視窗
local Main = Instance.new("Frame", ScreenGui)
Main.Name = "Main"
Main.Size = UDim2.new(0, 600, 0, 400)
Main.Position = UDim2.new(0.5, -300, 0.5, -200)
Main.BackgroundColor3 = Color3.fromRGB(10, 12, 15)
Main.BackgroundTransparency = 0.05
Main.Visible = false
Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 8)
local MainStroke = Instance.new("UIStroke", Main); MainStroke.Color = Color3.fromRGB(0, 255, 150); MainStroke.Thickness = 2

-- 側邊欄
local Sidebar = Instance.new("ScrollingFrame", Main)
Sidebar.Size = UDim2.new(0.3, 0, 0.75, 0)
Sidebar.BackgroundColor3 = Color3.fromRGB(15, 20, 25)
Sidebar.ScrollBarThickness = 0
local SideList = Instance.new("UIListLayout", Sidebar); SideList.Padding = UDim.new(0, 4); SideList.HorizontalAlignment = Enum.HorizontalAlignment.Center
Sidebar.AutomaticCanvasSize = Enum.AutomaticSize.Y
SideList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function() Sidebar.CanvasSize = UDim2.new(0,0,0,SideList.AbsoluteContentSize.Y+20) end)

local Title = Instance.new("TextLabel", Sidebar)
Title.Text = "頂點·神速"
Title.Font = Enum.Font.GothamBlack
Title.TextSize = 20
Title.TextColor3 = Color3.fromRGB(0, 255, 150)
Title.Size = UDim2.new(1,0,0,50)
Title.BackgroundTransparency = 1

-- 內容區
local Content = Instance.new("ScrollingFrame", Main)
Content.Size = UDim2.new(0.68, 0, 0.75, 0)
Content.Position = UDim2.new(0.31, 0, 0.05, 0)
Content.BackgroundTransparency = 1
Content.ScrollBarThickness = 4
local ContentList = Instance.new("UIListLayout", Content); ContentList.Padding = UDim.new(0, 8); ContentList.HorizontalAlignment = Enum.HorizontalAlignment.Center
Content.AutomaticCanvasSize = Enum.AutomaticSize.Y
ContentList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function() Content.CanvasSize = UDim2.new(0,0,0,ContentList.AbsoluteContentSize.Y+50) end)

-- 控制台
local ConsoleFrame = Instance.new("Frame", Main)
ConsoleFrame.Size = UDim2.new(0.95, 0, 0.18, 0)
ConsoleFrame.Position = UDim2.new(0.025, 0, 0.8, 0)
ConsoleFrame.BackgroundColor3 = Color3.fromRGB(5, 5, 5)
Instance.new("UICorner", ConsoleFrame).CornerRadius = UDim.new(0, 6)
Instance.new("UIStroke", ConsoleFrame).Color = Color3.fromRGB(0, 100, 50)

local ConsoleScroll = Instance.new("ScrollingFrame", ConsoleFrame)
ConsoleScroll.Size = UDim2.new(0.98, 0, 0.95, 0)
ConsoleScroll.Position = UDim2.new(0.01, 0, 0.025, 0)
ConsoleScroll.BackgroundTransparency = 1
ConsoleScroll.ScrollBarThickness = 2
local ConsoleList = Instance.new("UIListLayout", ConsoleScroll)

local function Log(msg, color)
    local Lbl = Instance.new("TextLabel", ConsoleScroll)
    Lbl.Text = "["..os.date("%H:%M:%S").."] " .. msg
    Lbl.Size = UDim2.new(1, 0, 0, 15)
    Lbl.TextColor3 = color or Color3.fromRGB(200, 200, 200)
    Lbl.BackgroundTransparency = 1
    Lbl.Font = Enum.Font.Code
    Lbl.TextSize = 10
    Lbl.TextXAlignment = Enum.TextXAlignment.Left
    ConsoleScroll.CanvasPosition = Vector2.new(0, 9999)
end

Log("Jenna Custom V5 (Fix) 已載入", Color3.fromRGB(0, 255, 100))

-- 加載列表
local function LoadList(category)
    for _, c in pairs(Content:GetChildren()) do if c:IsA("Frame") then c:Destroy() end end
    
    local list = Database[category]
    if list then
        for _, data in pairs(list.Scripts) do
            local F = Instance.new("Frame", Content)
            F.Size = UDim2.new(0.95, 0, 0, 70)
            F.BackgroundColor3 = Color3.fromRGB(25, 35, 30)
            Instance.new("UICorner", F).CornerRadius = UDim.new(0, 6)
            
            local Name = Instance.new("TextLabel", F)
            Name.Text = data.Name
            Name.Size = UDim2.new(0.7, 0, 0.4, 0)
            Name.Position = UDim2.new(0.05, 0, 0.1, 0)
            Name.TextColor3 = Color3.new(1,1,1)
            Name.Font = Enum.Font.GothamBold
            Name.TextXAlignment = Enum.TextXAlignment.Left
            Name.BackgroundTransparency = 1
            
            local Desc = Instance.new("TextLabel", F)
            Desc.Text = data.Desc
            Desc.Size = UDim2.new(0.7, 0, 0.4, 0)
            Desc.Position = UDim2.new(0.05, 0, 0.5, 0)
            Desc.TextColor3 = Color3.fromRGB(150, 200, 200)
            Desc.Font = Enum.Font.Gotham
            Desc.TextSize = 11
            Desc.TextXAlignment = Enum.TextXAlignment.Left
            Desc.BackgroundTransparency = 1
            Desc.TextWrapped = true
            
            local Run = Instance.new("TextButton", F)
            Run.Size = UDim2.new(0.2, 0, 0.6, 0)
            Run.Position = UDim2.new(0.78, 0, 0.2, 0)
            Run.BackgroundColor3 = Color3.fromRGB(0, 150, 100)
            Run.Text = "執行"
            Run.TextColor3 = Color3.new(1,1,1)
            Run.Font = Enum.Font.GothamBold
            Instance.new("UICorner", Run).CornerRadius = UDim.new(0, 4)
            
            Run.MouseButton1Click:Connect(function()
                if data.Type == "Raw" then
                    Log("執行自製模組: " .. data.Name, Color3.fromRGB(0, 255, 100))
                    local s, e = pcall(function() loadstring(data.Code)() end)
                    if not s then Log("執行錯誤: "..tostring(e), Color3.fromRGB(255, 0, 0)) end
                else
                    Log("下載外部腳本: " .. data.Name, Color3.fromRGB(255, 255, 0))
                    local s, r = pcall(function() return game:HttpGet(data.Url) end)
                    if s then
                        local es, er = pcall(function() loadstring(r)() end)
                        if es then Log("注入成功!", Color3.fromRGB(0, 255, 0))
                        else Log("腳本崩潰: "..tostring(er), Color3.fromRGB(255, 0, 0)) end
                    else
                        Log("下載失敗 (HTTP錯誤)", Color3.fromRGB(255, 0, 0))
                    end
                end
            end)
        end
    end
end

-- 生成側邊按鈕
local function AddSideBtn(text)
    local B = Instance.new("TextButton", Sidebar)
    B.Size = UDim2.new(0.9, 0, 0, 45)
    B.BackgroundColor3 = Color3.fromRGB(25, 30, 35)
    B.Text = text
    B.TextColor3 = Color3.fromRGB(100, 255, 200)
    B.Font = Enum.Font.GothamBold
    B.TextWrapped = true
    Instance.new("UICorner", B).CornerRadius = UDim.new(0, 6)
    B.MouseButton1Click:Connect(function() LoadList(text) end)
end

local keys = {}
for k in pairs(Database) do table.insert(keys, k) end
table.sort(keys)
for _, k in ipairs(keys) do if k ~= "Universal (通用)" then AddSideBtn(k) end end
AddSideBtn("Universal (通用)")

local Detected = "Universal (通用)"
for cat, data in pairs(Database) do for _, id in ipairs(data.IDs) do if id == PlaceID then Detected = cat; break end end end
LoadList(Detected)
if Detected ~= "Universal (通用)" then Log("已偵測並切換至: "..Detected, Color3.fromRGB(0, 200, 255)) end

Main.Visible = true
