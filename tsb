--[[
    çå¥¶è…³æœ¬ (ZhenNai Hub) - v14.0 è«¸ç¥é»ƒæ˜ç‰ˆ (RAGNAROK)
    æ ¸å¿ƒå‡ç´šï¼šç›¸ä½ç©¿é€ç”©é£› (Phase Fling) - ç›®å‰æœ€å¼·ç‰©ç†ç¢°æ’ç®—æ³•
    åŒ…å«åŠŸèƒ½ï¼šéš±èº«ã€ç‰¹æ•ˆã€ç¬ç§»å·¥å…·ã€UIä¿®å¾©
]]

-- 1. æ¸…ç†èˆŠä»‹é¢èˆ‡æ®˜ç•™ç‰©ç†
for _, gui in pairs(game.CoreGui:GetChildren()) do
    if gui.Name == "ZhenNai_Mobile_Controls" or gui.Name == "ZhenNai_Flash_Tool" then gui:Destroy() end
end
local LP = game:GetService("Players").LocalPlayer
if LP and LP.Character then
    for _, x in pairs(LP.Character:GetDescendants()) do
        if x.Name == "ZhenNai_Spin" or x.Name == "ZhenNai_Lift" then x:Destroy() end
    end
end

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer

-- [é…ç½®]
local Config = {
    -- æˆ°é¬¥
    TargetName = "", CurrentTarget = nil,
    FlingEnabled = false, 
    Hitbox = false, HitboxSize = 20, -- åŠ å¤§é è¨­åˆ¤å®š
    
    -- è¦–è¦º
    VisualsEnabled = true, Aura = true, Highlight = true, Lightning = true, ESP = false,
    
    -- ç§»å‹•
    Speed = 100, SpeedEnabled = false, Noclip = false, Invisible = false,
    
    -- å…¶ä»–
    SpinBot = false, SpinSpeed = 3000
}

--------------------------------------------------------------------------------
-- 0. æ ¸å¿ƒå‡½æ•¸ (ç‰©ç†èˆ‡æœå°‹)
--------------------------------------------------------------------------------
local function FindPlayer(string)
    if string == "" or string == nil then return nil end
    local found = nil
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer then
            if string.find(string.lower(p.Name), string.lower(string)) or 
               string.find(string.lower(p.DisplayName), string.lower(string)) then
                found = p
                break 
            end
        end
    end
    return found
end

-- [RAGNAROK Fling æ ¸å¿ƒ]
local function StartFling()
    if not Config.CurrentTarget then 
        Rayfield:Notify({Title="éŒ¯èª¤", Content="æœªé–å®šç›®æ¨™", Duration=2})
        return 
    end
    
    local Char = LocalPlayer.Character
    if not Char or not Char:FindFirstChild("HumanoidRootPart") then return end
    
    local Root = Char.HumanoidRootPart
    
    -- 1. æ¸…ç†èˆŠåŠ›å ´
    for _, x in pairs(Root:GetChildren()) do 
        if x:IsA("BodyAngularVelocity") or x:IsA("BodyVelocity") then x:Destroy() end 
    end
    
    -- 2. æ³¨å…¥è«¸ç¥é»ƒæ˜åŠ›å ´ (Ragnarok Force)
    -- æ—‹è½‰åŠ›å ´ï¼šè¨­ç‚ºæ¥µé™å€¼ï¼Œè£½é€ ç‰©ç†å´©å£
    local BAV = Instance.new("BodyAngularVelocity", Root)
    BAV.Name = "ZhenNai_Spin"
    BAV.MaxTorque = Vector3.new(9e9, 9e9, 9e9) -- ç„¡é™å¤§
    BAV.P = 10000 -- åæ‡‰é€Ÿåº¦
    BAV.AngularVelocity = Vector3.new(0, 100000, 0) -- è¶…å…‰é€Ÿæ—‹è½‰
    
    -- æ‡¸æµ®åŠ›å ´ï¼šé–å®š Y è»¸é˜²æ­¢è‡ªå·±æ‰è½ï¼Œä½†å…è¨± X/Z è»¸ç¢°æ’
    local BV = Instance.new("BodyVelocity", Root)
    BV.Name = "ZhenNai_Lift"
    BV.MaxForce = Vector3.new(9e9, 9e9, 9e9)
    BV.Velocity = Vector3.new(0, 0, 0) -- é  CFrame ç§»å‹•ï¼Œé€™è£¡æ­¸é›¶
    
    -- 3. ç‹€æ…‹è¨­å®š
    Config.Noclip = true -- å¼·åˆ¶ç©¿ç‰†ï¼Œé˜²æ­¢è‡ªå·±å¡æ­»
    if Char:FindFirstChild("Humanoid") then
        Char.Humanoid.PlatformStand = false -- å¿…é ˆä¿æŒç«™ç«‹æ‰æœ‰å‰›é«”ç¢°æ’
        Char.Humanoid.Sit = false
    end
    
    Rayfield:Notify({Title="è«¸ç¥é»ƒæ˜", Content="æ¯€æ»…æ¨¡å¼å•Ÿå‹•", Duration=1})
end

local function StopFling()
    local Char = LocalPlayer.Character
    if not Char or not Char:FindFirstChild("HumanoidRootPart") then return end
    
    for _, x in pairs(Char.HumanoidRootPart:GetChildren()) do 
        if x.Name == "ZhenNai_Spin" or x.Name == "ZhenNai_Lift" then x:Destroy() end 
    end
    
    -- ç…è»Š
    Char.HumanoidRootPart.Velocity = Vector3.new(0,0,0)
    Char.HumanoidRootPart.RotVelocity = Vector3.new(0,0,0)
    Char.HumanoidRootPart.AssemblyAngularVelocity = Vector3.new(0,0,0)
    Char.HumanoidRootPart.AssemblyLinearVelocity = Vector3.new(0,0,0)
end

-- [TP å·¥å…·]
local function GiveTPTool()
    if LocalPlayer.Backpack:FindFirstChild("å½±ä¹‹ç¬ç§»") then return end
    local tool = Instance.new("Tool", LocalPlayer.Backpack)
    tool.Name = "å½±ä¹‹ç¬ç§»"
    tool.RequiresHandle = false
    tool.Activated:Connect(function()
        local Mouse = LocalPlayer:GetMouse()
        if Mouse and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(Mouse.Hit.Position + Vector3.new(0,3,0))
        end
    end)
end

-- [ç‰¹æ•ˆç®¡ç†å™¨]
local function UpdateFX(char, enable)
    if not char then return end
    local root = char:FindFirstChild("HumanoidRootPart")
    if not enable then
        for _, v in pairs(char:GetDescendants()) do if v.Name == "ZN_HL" or v.Name == "ZN_PT" or v.Name == "ZN_LT" then v:Destroy() end end
        return
    end
    if Config.Highlight and not char:FindFirstChild("ZN_HL") then
        local hl = Instance.new("Highlight", char); hl.Name = "ZN_HL"; hl.FillColor = Color3.new(0,0,0); hl.OutlineColor = Color3.fromRGB(255,0,0); hl.FillTransparency = 0.5
    end
    if Config.Aura and root and not root:FindFirstChild("ZN_PT") then
        local p = Instance.new("ParticleEmitter", root); p.Name = "ZN_PT"; p.Texture = "rbxassetid://243660364"; p.Rate = 150; p.ZOffset = -1; p.Color = ColorSequence.new({ColorSequenceKeypoint.new(0,Color3.fromRGB(50,0,0)), ColorSequenceKeypoint.new(1,Color3.fromRGB(255,50,50))})
    end
    if Config.Lightning and root and not root:FindFirstChild("ZN_LT") then
        local p = Instance.new("ParticleEmitter", root); p.Name = "ZN_LT"; p.Texture = "rbxassetid://242205514"; p.Rate = 60; p.Rotation = NumberRange.new(0,360); p.RotSpeed = NumberRange.new(500); p.Color = ColorSequence.new(Color3.fromRGB(255,200,50))
    end
end

--------------------------------------------------------------------------------
-- 1. [UI] æš´åŠ›ä¿®å¾©ç‰ˆä»‹é¢
--------------------------------------------------------------------------------
local Window = Rayfield:CreateWindow({
    Name = "çå¥¶è…³æœ¬ | SYSTEM: RAGNAROK v14",
    LoadingTitle = "ç‰©ç†å¼•æ“è¶…é »ä¸­...",
    ConfigurationSaving = { Enabled = false },
    KeySystem = false, 
})

local CombatTab = Window:CreateTab("ğŸ’€ æ¯€æ»…", 4483362458)
local MoveTab = Window:CreateTab("âš¡ ç§»å‹•", 4483362458)
local FXTab = Window:CreateTab("âœ¨ è¦–è¦º", 4483362458)

-- [æ‰‹æ©Ÿæ§åˆ¶é …]
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
ScreenGui.Name = "ZhenNai_Mobile_Controls"

-- ç¶ è‰²é¸å–®é–‹é—œ
local MenuBtn = Instance.new("TextButton", ScreenGui)
MenuBtn.Size = UDim2.new(0, 100, 0, 40); MenuBtn.Position = UDim2.new(0,10,0,10); MenuBtn.BackgroundColor3 = Color3.fromRGB(0,200,100); MenuBtn.Text = "é¸å–®é–‹é—œ"; MenuBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", MenuBtn).CornerRadius = UDim.new(0,8)

-- ç´…è‰²è™•æ±ºæŒ‰éˆ•
local HuntBtn = Instance.new("TextButton", ScreenGui)
HuntBtn.Size = UDim2.new(0, 85, 0, 85); HuntBtn.Position = UDim2.new(0.8,0,0.45,0); HuntBtn.BackgroundColor3 = Color3.fromRGB(0,0,0); HuntBtn.BackgroundTransparency = 0.3
HuntBtn.Text = "æ¯€æ»…"; HuntBtn.TextColor3 = Color3.fromRGB(255,0,0); HuntBtn.TextSize = 20; HuntBtn.Font = Enum.Font.GothamBlack
Instance.new("UICorner", HuntBtn).CornerRadius = UDim.new(1,0); Instance.new("UIStroke", HuntBtn).Color = Color3.fromRGB(255,0,0); Instance.new("UIStroke", HuntBtn).Thickness = 2.5

-- è—è‰²éš±å½¢æŒ‰éˆ•
local InvisBtn = Instance.new("TextButton", ScreenGui)
InvisBtn.Size = UDim2.new(0, 85, 0, 85); InvisBtn.Position = UDim2.new(0.8,0,0.60,0); InvisBtn.BackgroundColor3 = Color3.fromRGB(0,0,0); InvisBtn.BackgroundTransparency = 0.3
InvisBtn.Text = "éš±å½¢"; InvisBtn.TextColor3 = Color3.fromRGB(150,150,255); InvisBtn.TextSize = 20; InvisBtn.Font = Enum.Font.GothamBlack
Instance.new("UICorner", InvisBtn).CornerRadius = UDim.new(1,0); Instance.new("UIStroke", InvisBtn).Color = Color3.fromRGB(150,150,255); Instance.new("UIStroke", InvisBtn).Thickness = 2.5

-- [é¸å–®é–‹é—œé‚è¼¯]
local isMenuOpen = true
MenuBtn.MouseButton1Click:Connect(function()
    isMenuOpen = not isMenuOpen
    local Found = false
    for _, gui in pairs(game.CoreGui:GetChildren()) do
        if gui:IsA("ScreenGui") then
            for _, descendant in pairs(gui:GetDescendants()) do
                if descendant:IsA("TextLabel") and string.find(descendant.Text, "RAGNAROK") then
                    gui.Enabled = isMenuOpen; Found = true; break
                end
            end
        end
        if Found then break end
    end
end)

--------------------------------------------------------------------------------
-- 2. åŠŸèƒ½å…§å®¹
--------------------------------------------------------------------------------
-- æˆ°é¬¥
CombatTab:CreateInput({Name = "ç›®æ¨™åç¨± (ID/Name)", PlaceholderText = "è¼¸å…¥å¾ŒæŒ‰ Enter", Callback = function(Text)
    Config.TargetName = Text; local t = FindPlayer(Text)
    if t then Config.CurrentTarget = t; Rayfield:Notify({Title="é–å®š", Content=t.Name, Duration=2}) end
end})
CombatTab:CreateToggle({Name = "å•Ÿå‹•ï¼šè«¸ç¥é»ƒæ˜ (Fling)", CurrentValue = false, Callback = function(v) Config.FlingEnabled = v; if v then StartFling() else StopFling() end end})
CombatTab:CreateToggle({Name = "æ“´å¤§åˆ¤å®š (Hitbox)", CurrentValue = false, Callback = function(v) Config.Hitbox = v end})
CombatTab:CreateSlider({Name = "åˆ¤å®šå¤§å°", Range = {5, 50}, Increment = 1, CurrentValue = 20, Callback = function(v) Config.HitboxSize = v end})

-- ç§»å‹•
MoveTab:CreateButton({Name = "é ˜å–ç¬ç§»å·¥å…·", Callback = function() GiveTPTool(); Rayfield:Notify({Title="ç³»çµ±",Content="å·¥å…·å·²ç™¼é€",Duration=1}) end})
MoveTab:CreateToggle({Name = "æ­»äº¡è¿´æ—‹ (Spinbot)", CurrentValue = false, Callback = function(v) Config.SpinBot = v end})
MoveTab:CreateSlider({Name = "é€Ÿåº¦ (Speed)", Range = {16, 500}, Increment = 5, CurrentValue = 100, Callback = function(v) Config.Speed = v end})
MoveTab:CreateToggle({Name = "å•Ÿç”¨é€Ÿåº¦", CurrentValue = false, Callback = function(v) Config.SpeedEnabled = v end})
MoveTab:CreateToggle({Name = "ç©¿ç‰† (Noclip)", CurrentValue = false, Callback = function(v) Config.Noclip = v end})

-- è¦–è¦º
FXTab:CreateToggle({Name = "ç‰¹æ•ˆç¸½é–‹é—œ", CurrentValue = true, Callback = function(v) Config.VisualsEnabled = v; UpdateFX(LocalPlayer.Character, v) end})
FXTab:CreateToggle({Name = "å®Œå…¨éš±å½¢ (Invisible)", CurrentValue = false, Callback = function(v)
    Config.Invisible = v
    if not v and LocalPlayer.Character then 
         LocalPlayer.Character.Humanoid.DisplayDistanceType = Enum.HumanoidDisplayDistanceType.Viewer
         for _, p in pairs(LocalPlayer.Character:GetDescendants()) do
             if (p:IsA("BasePart") or p:IsA("Decal")) and p.Name ~= "HumanoidRootPart" then p.Transparency = 0 end
         end
    end
end})
FXTab:CreateToggle({Name = "ESP (Name)", CurrentValue = false, Callback = function(v) Config.ESP = v end})

--------------------------------------------------------------------------------
-- 3. æ ¸å¿ƒå¾ªç’° (The Loop) - ç‰©ç†å¢å¼·é‡é»
--------------------------------------------------------------------------------
HuntBtn.MouseButton1Click:Connect(function() Config.FlingEnabled = not Config.FlingEnabled; if Config.FlingEnabled then HuntBtn.Text="åœæ­¢"; StartFling() else HuntBtn.Text="æ¯€æ»…"; StopFling() end end)
InvisBtn.MouseButton1Click:Connect(function() Config.Invisible = not Config.Invisible; if Config.Invisible then InvisBtn.Text="ç¾èº«" else InvisBtn.Text="éš±å½¢" end end)

-- [RenderStepped] è² è²¬ CFrame ç©¿é€ (ç›¸ä½æ”»æ“Š)
RunService.RenderStepped:Connect(function()
    local Char = LocalPlayer.Character
    if not Char or not Char:FindFirstChild("HumanoidRootPart") then return end
    
    -- 1. Fling é‚è¼¯ (ç›¸ä½ç©¿é€)
    if Config.FlingEnabled and Config.CurrentTarget then
        local TChar = Config.CurrentTarget.Character
        if TChar and TChar:FindFirstChild("HumanoidRootPart") then
            -- [é‡é»åŠ å¼·]ï¼šä¸åªæ˜¯è·Ÿéš¨ï¼Œè€Œæ˜¯å¿«é€ŸæŠ–å‹•ç©¿æ’
            -- éš¨æ©Ÿç”¢ç”Ÿä¸€å€‹ -1.5 åˆ° 1.5 çš„åç§»é‡ï¼Œè®“ç‰©ç†å¼•æ“ç™¼ç˜‹
            local jitter = Vector3.new(math.random(-15, 15)/10, -1, math.random(-15, 15)/10)
            Char.HumanoidRootPart.CFrame = TChar.HumanoidRootPart.CFrame * CFrame.new(jitter)
            Char.HumanoidRootPart.Velocity = Vector3.new(0, 0, 0) -- é¿å…è¢«è‡ªå·±çš„é€Ÿåº¦ç”©é£›
        else
            Config.FlingEnabled = false; StopFling()
        end
    end
    
    -- 2. éš±å½¢
    if Config.Invisible then
        if Char:FindFirstChild("Humanoid") then Char.Humanoid.DisplayDistanceType = Enum.HumanoidDisplayDistanceType.None end
        for _, v in pairs(Char:GetDescendants()) do
            if v:IsA("BasePart") and v.Name ~= "HumanoidRootPart" then v.Transparency = 1; v.CanCollide = false end
            if v:IsA("Decal") then v.Transparency = 1 end
        end
    end
    
    -- 3. ESP
    if Config.ESP then
        for _, p in pairs(Players:GetPlayers()) do
            if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("Head") and not p.Character:FindFirstChild("ZN_ESP") then
                local bb = Instance.new("BillboardGui", p.Character.Head); bb.Name = "ZN_ESP"; bb.Size = UDim2.new(0,100,0,50); bb.AlwaysOnTop = true
                local t = Instance.new("TextLabel", bb); t.Size = UDim2.new(1,0,1,0); t.BackgroundTransparency=1; t.TextColor3 = Color3.new(1,0,0); t.Text = p.Name
            end
        end
    else
        for _, p in pairs(Players:GetPlayers()) do if p.Character and p.Character:FindFirstChild("ZN_ESP") then p.Character.ZN_ESP:Destroy() end end
    end
end)

-- [Heartbeat] è² è²¬ç‰©ç†ç‹€æ…‹
RunService.Heartbeat:Connect(function()
    local Char = LocalPlayer.Character
    if not Char then return end
    local Humanoid = Char:FindFirstChild("Humanoid")
    
    if Config.SpeedEnabled and Humanoid then Humanoid.WalkSpeed = Config.Speed end
    
    -- å¼·åˆ¶ Noclip (ç©¿ç‰†) åœ¨ç”©é£›æ™‚æ¥µç‚ºé‡è¦
    if Config.Noclip or Config.FlingEnabled then
        for _, part in pairs(Char:GetChildren()) do
            if part:IsA("BasePart") then part.CanCollide = false end
        end
    end
    
    -- Spinbot é‚è¼¯
    if Config.SpinBot and Char:FindFirstChild("HumanoidRootPart") then
        Char.HumanoidRootPart.CFrame = Char.HumanoidRootPart.CFrame * CFrame.Angles(0, math.rad(50), 0)
    end

    -- Hitbox
    if Config.Hitbox then
        for _, p in pairs(Players:GetPlayers()) do
            if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("Head") then
                p.Character.Head.Size = Vector3.new(Config.HitboxSize, Config.HitboxSize, Config.HitboxSize)
                p.Character.Head.Transparency = 0.6; p.Character.Head.CanCollide = false
            end
        end
    end
end)

LocalPlayer.CharacterAdded:Connect(function(newChar) task.wait(1); if Config.VisualsEnabled then UpdateFX(newChar, true) end end)
Rayfield:Notify({Title = "è«¸ç¥é»ƒæ˜ v14", Content = "ç›¸ä½ç©¿é€ç‰©ç†å·²è£è¼‰ã€‚å¨åŠ›æœ€å¤§åŒ–ã€‚", Duration = 5})
