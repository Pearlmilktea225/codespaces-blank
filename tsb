--[[
    SYSTEM: APEX (THE ULTIMATE FUSION)
    視覺：3D Viewport + Cinema Intro + RGB Flow
    內核：True Damage Input + Cloud Library + Rage Logic
    狀態：[GOD MODE]
]]

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local Debris = game:GetService("Debris")
local Lighting = game:GetService("Lighting")
local CoreGui = game:GetService("CoreGui")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- [0. 虛空重置]
for _, g in pairs(CoreGui:GetChildren()) do
    if g.Name == "APEX_SYSTEM" then g:Destroy() end
end

-- [1. APEX 視覺引擎]
local function PlaySound(type)
    local s = Instance.new("Sound", workspace)
    if type == "Boot" then s.SoundId = "rbxassetid://130768227"
    elseif type == "Hover" then s.SoundId = "rbxassetid://6895079853"
    elseif type == "Click" then s.SoundId = "rbxassetid://6042053626"
    elseif type == "Skill" then s.SoundId = "rbxassetid://2977754636"
    end
    s.Volume = 2; s:Play(); Debris:AddItem(s, 2)
end

local function TypeWriter(label, text)
    label.Text = ""
    for i = 1, #text do
        label.Text = string.sub(text, 1, i)
        if i % 2 == 0 then 
            local s = Instance.new("Sound", workspace); s.SoundId="rbxassetid://9114221327"; s.Volume=0.2; s:Play(); Debris:AddItem(s,0.5)
        end
        task.wait(0.03)
    end
end

-- [2. 真傷輸入內核 (不修改 Hitbox，只模擬操作)]
local function TriggerAction(index)
    -- A. 手機端暴力點擊
    local PG = LocalPlayer:FindFirstChild("PlayerGui")
    if PG then
        local targets = {tostring(index), "Skill"..index, "Ability"..index}
        for _, v in pairs(PG:GetDescendants()) do
            if (v:IsA("TextButton") or v:IsA("ImageButton")) and v.Visible then
                for _, t in ipairs(targets) do
                    if v.Name == t then
                        for _, c in pairs(getconnections(v.MouseButton1Click)) do c:Fire() end
                        for _, c in pairs(getconnections(v.Activated)) do c:Fire() end
                        break
                    end
                end
            end
        end
    end
    -- B. 電腦端鍵盤模擬
    local k = (index==1 and Enum.KeyCode.One) or (index==2 and Enum.KeyCode.Two) or (index==3 and Enum.KeyCode.Three) or (index==4 and Enum.KeyCode.Four)
    VirtualInputManager:SendKeyEvent(true, k, false, game)
    task.wait(0.1)
    VirtualInputManager:SendKeyEvent(false, k, false, game)
end

-- [3. 視覺附魔 (VFX Augment)]
local function VisualBurst(color)
    local Root = LocalPlayer.Character.HumanoidRootPart
    -- 震動
    local tw = TweenService:Create(Camera, TweenInfo.new(0.05, Enum.EasingStyle.Sine, Enum.EasingDirection.Out, 0, true), {FieldOfView = 75})
    tw:Play(); task.wait(0.05); TweenService:Create(Camera, TweenInfo.new(0.2), {FieldOfView = 70}):Play()
    -- 爆氣
    local p = Instance.new("Part", workspace); p.Size=Vector3.new(1,1,1); p.Shape="Ball"; p.Color=color; p.Material="Neon"; p.Anchored=true; p.CanCollide=false; p.CFrame=Root.CFrame
    TweenService:Create(p, TweenInfo.new(0.4), {Size=Vector3.new(35,35,35), Transparency=1}):Play(); Debris:AddItem(p, 0.4)
end

-- [4. UI 建構：APEX 框架]
local ScreenGui = Instance.new("ScreenGui", CoreGui)
ScreenGui.Name = "APEX_SYSTEM"
ScreenGui.IgnoreGuiInset = true

-- [電影級啟動動畫]
local Intro = Instance.new("Frame", ScreenGui); Intro.Size=UDim2.new(1,0,1,0); Intro.BackgroundColor3=Color3.new(0,0,0); Intro.ZIndex=100
local IntroTxt = Instance.new("TextLabel", Intro); IntroTxt.Size=UDim2.new(1,0,0.2,0); IntroTxt.Position=UDim2.new(0,0,0.4,0); IntroTxt.BackgroundTransparency=1; IntroTxt.TextColor3=Color3.fromRGB(0,255,255); IntroTxt.Font=Enum.Font.Sarpanch; IntroTxt.TextSize=35; IntroTxt.Text=""

task.spawn(function()
    PlaySound("Boot")
    TypeWriter(IntroTxt, "SYSTEM: APEX INITIALIZING...")
    task.wait(0.5)
    TypeWriter(IntroTxt, "OVERRIDING SECURITY...")
    task.wait(0.5)
    TweenService:Create(Intro, TweenInfo.new(1), {BackgroundTransparency=1}):Play()
    TweenService:Create(IntroTxt, TweenInfo.new(1), {TextTransparency=1}):Play()
    task.delay(1, function() Intro:Destroy() end)
end)

-- [主視窗]
local Main = Instance.new("Frame", ScreenGui)
Main.Size = UDim2.new(0, 700, 0, 450)
Main.Position = UDim2.new(0.5, -350, 0.5, -225)
Main.BackgroundColor3 = Color3.fromRGB(10, 10, 15)
Main.BackgroundTransparency = 0.05
Main.Visible = false -- 等動畫
Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 10)
local Stroke = Instance.new("UIStroke", Main); Stroke.Color = Color3.fromRGB(0, 255, 255); Stroke.Thickness = 2
-- 流光特效
task.spawn(function()
    while Main.Parent do
        local t = tick() % 5 / 5
        local color = Color3.fromHSV(t, 1, 1)
        Stroke.Color = color
        task.wait(0.05)
    end
end)

task.delay(3, function() Main.Visible = true; Main.Size=UDim2.new(0,0,0,0); TweenService:Create(Main, TweenInfo.new(0.5, Enum.EasingStyle.Back), {Size=UDim2.new(0,700,0,450)}):Play() end)

-- [左側：3D 角色投影 (The Mirror)]
local Viewport = Instance.new("ViewportFrame", Main)
Viewport.Size = UDim2.new(0.35, 0, 0.8, 0)
Viewport.Position = UDim2.new(0.02, 0, 0.15, 0)
Viewport.BackgroundTransparency = 1
local VPCam = Instance.new("Camera"); Viewport.CurrentCamera = VPCam; VPCam.Parent = Viewport

task.spawn(function()
    wait(3)
    if LocalPlayer.Character then
        LocalPlayer.Character.Archivable = true
        local Clone = LocalPlayer.Character:Clone(); Clone.Parent = Viewport
        for _,s in pairs(Clone:GetDescendants()) do if s:IsA("Script") then s:Destroy() end end
        local HRP = Clone:FindFirstChild("HumanoidRootPart")
        if HRP then
            VPCam.CFrame = CFrame.new(HRP.Position + Vector3.new(0,2,-7), HRP.Position)
            RunService.RenderStepped:Connect(function() 
                if Clone.PrimaryPart then Clone:SetPrimaryPartCFrame(Clone.PrimaryPart.CFrame * CFrame.Angles(0,0.01,0)) end 
            end)
        end
    end
end)

-- [右側：功能矩陣]
local Title = Instance.new("TextLabel", Main); Title.Text="APEX // CONTROL"; Title.Size=UDim2.new(0.6,0,0.1,0); Title.Position=UDim2.new(0.4,0,0.05,0); Title.Font=Enum.Font.Sarpanch; Title.TextSize=30; Title.TextColor3=Color3.new(1,1,1); Title.BackgroundTransparency=1; Title.TextXAlignment=Enum.TextXAlignment.Left

local TabContainer = Instance.new("Frame", Main); TabContainer.Size=UDim2.new(0.55,0,0.08,0); TabContainer.Position=UDim2.new(0.4,0,0.15,0); TabContainer.BackgroundTransparency=1
local TabList = Instance.new("UIListLayout", TabContainer); TabList.FillDirection=Enum.FillDirection.Horizontal; TabList.Padding=UDim.new(0,10)

local Content = Instance.new("Frame", Main); Content.Size=UDim2.new(0.55,0,0.7,0); Content.Position=UDim2.new(0.4,0,0.25,0); Content.BackgroundTransparency=1; Content.ClipsDescendants=true

-- 分頁邏輯
local CurrentPage = nil
local function Switch(page)
    if CurrentPage then CurrentPage.Visible=false end
    page.Visible=true; CurrentPage=page
    PlaySound("Click")
end

local function AddTab(text, page)
    local B = Instance.new("TextButton", TabContainer); B.Size=UDim2.new(0.3,0,1,0); B.BackgroundColor3=Color3.fromRGB(20,20,30); B.Text=text; B.TextColor3=Color3.new(1,1,1); B.Font=Enum.Font.GothamBold; Instance.new("UICorner",B).CornerRadius=UDim.new(0,5)
    B.MouseButton1Click:Connect(function() Switch(page) end)
end

-- [頁面 1: DOMINATION (戰鬥)]
local CombatPage = Instance.new("ScrollingFrame", Content); CombatPage.Size=UDim2.new(1,0,1,0); CombatPage.BackgroundTransparency=1; CombatPage.ScrollBarThickness=3; CombatPage.Visible=false; CombatPage.AutomaticCanvasSize=Enum.AutomaticSize.Y; CombatPage.CanvasSize=UDim2.new(0,0,0,0)
local CombatList = Instance.new("UIListLayout", CombatPage); CombatList.Padding=UDim.new(0,8)

local function AddToggle(name, func)
    local B = Instance.new("TextButton", CombatPage); B.Size=UDim2.new(1,0,0,45); B.BackgroundColor3=Color3.fromRGB(30,30,40); B.Text=name.." [OFF]"; B.TextColor3=Color3.fromRGB(255,100,100); B.Font=Enum.Font.GothamBold; Instance.new("UICorner",B).CornerRadius=UDim.new(0,5)
    local on = false
    B.MouseButton1Click:Connect(function()
        on = not on
        if on then B.Text=name.." [ON]"; B.TextColor3=Color3.new(0,1,0); B.BackgroundColor3=Color3.fromRGB(40,50,60) else B.Text=name.." [OFF]"; B.TextColor3=Color3.fromRGB(255,100,100); B.BackgroundColor3=Color3.fromRGB(30,30,40) end
        func(on)
        PlaySound("Click")
    end)
end

AddToggle("KILL AURA (暴力)", function(v) 
    _G.KA = v
    RunService.Heartbeat:Connect(function()
        if _G.KA then for _,p in pairs(Players:GetPlayers()) do if p~=LocalPlayer and p.Character and (p.Character.HumanoidRootPart.Position-LocalPlayer.Character.HumanoidRootPart.Position).Magnitude<20 then VirtualInputManager:SendMouseButtonEvent(0,0,0,true,game,1); VirtualInputManager:SendMouseButtonEvent(0,0,0,false,game,1) end end end
    end)
end)
AddToggle("FLING AURA (撞飛)", function(v) 
    _G.FA = v
    RunService.Heartbeat:Connect(function()
        if _G.FA then 
            local Root = LocalPlayer.Character.HumanoidRootPart
            local BAV = Root:FindFirstChild("ZN_Spin") or Instance.new("BodyAngularVelocity", Root); BAV.Name="ZN_Spin"; BAV.MaxTorque=Vector3.new(9e9,9e9,9e9); BAV.AngularVelocity=Vector3.new(0,10000,0)
            for _,p in pairs(Players:GetPlayers()) do if p~=LocalPlayer and p.Character and (p.Character.HumanoidRootPart.Position-Root.Position).Magnitude<15 then Root.CFrame=p.Character.HumanoidRootPart.CFrame*CFrame.new(0,-1,0); Root.Velocity=Vector3.zero end end
        else
             if LocalPlayer.Character and LocalPlayer.Character.HumanoidRootPart:FindFirstChild("ZN_Spin") then LocalPlayer.Character.HumanoidRootPart.ZN_Spin:Destroy() end
        end
    end)
end)
AddToggle("GOD SPEED (加速)", function(v) RunService.Heartbeat:Connect(function() if v then LocalPlayer.Character.Humanoid.WalkSpeed=60 end end) end)

-- [頁面 2: SHADOW (動作)]
local MovePage = Instance.new("ScrollingFrame", Content); MovePage.Size=UDim2.new(1,0,1,0); MovePage.BackgroundTransparency=1; MovePage.Visible=false; MovePage.AutomaticCanvasSize=Enum.AutomaticSize.Y; MovePage.CanvasSize=UDim2.new(0,0,0,0)
local MoveList = Instance.new("UIListLayout", MovePage); MoveList.Padding=UDim.new(0,8)

local function AddSkill(id, name, color)
    local B = Instance.new("TextButton", MovePage); B.Size=UDim2.new(1,0,0,50); B.BackgroundColor3=Color3.fromRGB(20,20,35); B.Text=""; Instance.new("UICorner",B).CornerRadius=UDim.new(0,5); local Str = Instance.new("UIStroke",B); Str.Color=color; Str.Thickness=1
    local T = Instance.new("TextLabel", B); T.Text="["..id.."] "..name; T.Size=UDim2.new(1,0,1,0); T.BackgroundTransparency=1; T.TextColor3=Color3.new(1,1,1); T.Font=Enum.Font.GothamBlack; T.TextSize=18
    
    B.MouseEnter:Connect(function() TweenService:Create(B, TweenInfo.new(0.2), {BackgroundColor3=color}):Play(); PlaySound("Hover") end)
    B.MouseLeave:Connect(function() TweenService:Create(B, TweenInfo.new(0.2), {BackgroundColor3=Color3.fromRGB(20,20,35)}):Play() end)
    
    B.MouseButton1Click:Connect(function()
        TriggerAction(id)
        VisualBurst(color)
        PlaySound("Skill")
    end)
end

AddSkill(1, "RUSH // 連擊", Color3.fromRGB(0, 255, 255))
AddSkill(2, "SMASH // 重擊", Color3.fromRGB(255, 50, 50))
AddSkill(3, "ARISE // 提取", Color3.fromRGB(150, 0, 255))
AddSkill(4, "DOMAIN // 領域", Color3.fromRGB(255, 255, 0))

-- [頁面 3: LIBRARY (雲端庫)]
local HubPage = Instance.new("ScrollingFrame", Content); HubPage.Size=UDim2.new(1,0,1,0); HubPage.BackgroundTransparency=1; HubPage.Visible=false; HubPage.AutomaticCanvasSize=Enum.AutomaticSize.Y; HubPage.CanvasSize=UDim2.new(0,0,0,0)
local HubList = Instance.new("UIListLayout", HubPage); HubList.Padding=UDim.new(0,8)

local function AddLoader(name, url)
    local B = Instance.new("TextButton", HubPage); B.Size=UDim2.new(1,0,0,40); B.BackgroundColor3=Color3.fromRGB(10,30,10); B.Text="LOAD: "..name; B.TextColor3=Color3.fromRGB(100,255,100); B.Font=Enum.Font.Mono; Instance.new("UICorner",B).CornerRadius=UDim.new(0,5)
    B.MouseButton1Click:Connect(function() loadstring(game:HttpGet(url))() end)
end

AddLoader("INFINITE YIELD", "https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source")
AddLoader("DEX EXPLORER", "https://raw.githubusercontent.com/infyiff/backup/main/dex.lua")
AddLoader("REMOTE SPY", "https://raw.githubusercontent.com/exxtremestuffs/SimpleSpySource/master/SimpleSpy.lua")

-- [初始化]
AddTab("COMBAT", CombatPage)
AddTab("SHADOW", MovePage)
AddTab("LIBRARY", HubPage)
Switch(MovePage) -- 預設頁面

-- 手機最小化
if game:GetService("UserInputService").TouchEnabled then
    local M = Instance.new("TextButton", ScreenGui); M.Size=UDim2.new(0,50,0,50); M.Position=UDim2.new(0,10,0,50); M.BackgroundColor3=Color3.new(0,0,0); M.BackgroundTransparency=0.3; M.Text="A"; M.TextColor3=Color3.new(0,1,1); Instance.new("UICorner",M).CornerRadius=UDim.new(0.5,0); Instance.new("UIStroke",M).Color=Color3.new(0,1,1)
    M.MouseButton1Click:Connect(function() Main.Visible = not Main.Visible end)
end
