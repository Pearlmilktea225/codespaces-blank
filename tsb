--[[
    çå¥¶è…³æœ¬ (ZhenNai Hub) - v11.0 UI é‡æ§‹ç‰ˆ
    ä¿®å¾©ï¼šåŠŸèƒ½ GUI æ¶ˆå¤±å•é¡Œ
    æ–°å¢ï¼š[MENU] æŒ‰éˆ• (é˜²æ­¢é¸å–®é—œé–‰å¾Œæ‰“ä¸é–‹)
    åŠŸèƒ½ï¼šå…¨éƒ¨åƒæ•¸å¯è¦–åŒ–
]]

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = game.Workspace.CurrentCamera

-- [é…ç½®å…¨å±•é–‹]
local Config = {
    TargetName = "",
    CurrentTarget = nil,
    
    -- æˆ°é¬¥
    FlingEnabled = false,
    Hitbox = false, 
    HitboxSize = 15, -- é è¨­åˆ¤å®šå¤§å°
    
    -- è¦–è¦º
    VisualsEnabled = true,
    Aura = true,
    Highlight = true,
    Lightning = true,
    AggroMode = true,
    ESP = false, -- åŠ å› ESP
    
    -- å±¬æ€§
    Speed = 100, SpeedEnabled = false,
    Noclip = false,
    Invisible = false
}

--------------------------------------------------------------------------------
-- 0. æ ¸å¿ƒåŠŸèƒ½ (ç‰©ç†èˆ‡æœå°‹)
--------------------------------------------------------------------------------
local function FindPlayer(string)
    if string == "" or string == nil then return nil end
    local found = nil
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer then
            if string.find(string.lower(p.Name), string.lower(string)) or 
               string.find(string.lower(p.DisplayName), string.lower(string)) then
                found = p
                break 
            end
        end
    end
    return found
end

-- è™•æ±ºé‚è¼¯ (BodyMovers)
local function StartFling()
    if not Config.CurrentTarget then return end
    local Char = LocalPlayer.Character
    if not Char or not Char:FindFirstChild("HumanoidRootPart") then return end
    
    local Root = Char.HumanoidRootPart
    for _, x in pairs(Root:GetChildren()) do
        if x:IsA("BodyAngularVelocity") or x:IsA("BodyVelocity") then x:Destroy() end
    end
    
    local BAV = Instance.new("BodyAngularVelocity", Root)
    BAV.Name = "ZhenNai_Spin"; BAV.MaxTorque = Vector3.new(math.huge,math.huge,math.huge); BAV.AngularVelocity = Vector3.new(0, 10000, 0)
    
    local BV = Instance.new("BodyVelocity", Root)
    BV.Name = "ZhenNai_Float"; BV.MaxForce = Vector3.new(math.huge,math.huge,math.huge); BV.Velocity = Vector3.new(0, 0, 0)
    
    Rayfield:Notify({Title="è™•æ±ºå•Ÿå‹•", Content="ç‰©ç†ç‰©ä»¶å·²æ³¨å…¥", Duration=1})
end

local function StopFling()
    local Char = LocalPlayer.Character
    if not Char or not Char:FindFirstChild("HumanoidRootPart") then return end
    for _, x in pairs(Char.HumanoidRootPart:GetChildren()) do
        if x.Name == "ZhenNai_Spin" or x.Name == "ZhenNai_Float" then x:Destroy() end
    end
    Char.HumanoidRootPart.Velocity = Vector3.new(0,0,0)
    Char.HumanoidRootPart.RotVelocity = Vector3.new(0,0,0)
end

-- ç‰¹æ•ˆé‚è¼¯
local function UpdateFX(char, enable)
    if not char then return end
    local root = char:FindFirstChild("HumanoidRootPart")
    
    if not enable then
        for _, v in pairs(char:GetDescendants()) do
            if v.Name == "MonarchHighlight" or v.Name == "MonarchParticle" or v.Name == "MonarchLightning" then v:Destroy() end
        end
        return
    end

    if Config.Highlight and not char:FindFirstChild("MonarchHighlight") then
        local hl = Instance.new("Highlight", char)
        hl.Name = "MonarchHighlight"; hl.FillColor = Color3.new(0,0,0); hl.OutlineColor = Color3.fromRGB(150,0,255); hl.FillTransparency = 0.5
    end
    if Config.Aura and root and not root:FindFirstChild("MonarchParticle") then
        local p = Instance.new("ParticleEmitter", root)
        p.Name = "MonarchParticle"; p.Texture = "rbxassetid://243660364"; p.Rate = 100; p.ZOffset = -1
        p.Color = ColorSequence.new({ColorSequenceKeypoint.new(0,Color3.fromRGB(20,0,50)), ColorSequenceKeypoint.new(1,Color3.fromRGB(100,50,255))})
    end
    if Config.Lightning and root and not root:FindFirstChild("MonarchLightning") then
        local p = Instance.new("ParticleEmitter", root)
        p.Name = "MonarchLightning"; p.Texture = "rbxassetid://242205514"; p.Rate = 50
        p.Rotation = NumberRange.new(0,360); p.RotSpeed = NumberRange.new(500); p.Color = ColorSequence.new(Color3.fromRGB(0,255,255))
    end
end

--------------------------------------------------------------------------------
-- 1. [æ–°å¢] ä»‹é¢æ•‘æ´æŒ‰éˆ• (UI Toggle)
--------------------------------------------------------------------------------
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ZhenNai_Main_Controls"
if game.CoreGui:FindFirstChild("ZhenNai_Main_Controls") then game.CoreGui.ZhenNai_Main_Controls:Destroy() end
ScreenGui.Parent = game.CoreGui

-- 1. é¸å–®é–‹é—œ (ç¶ è‰²æŒ‰éˆ•)
local MenuBtn = Instance.new("TextButton")
MenuBtn.Parent = ScreenGui
MenuBtn.Size = UDim2.new(0, 100, 0, 40)
MenuBtn.Position = UDim2.new(0, 10, 0, 10) -- å·¦ä¸Šè§’
MenuBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 100)
MenuBtn.Text = "æ‰“é–‹/é—œé–‰é¸å–®"
MenuBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", MenuBtn).CornerRadius = UDim.new(0, 8)

-- 2. æ‰‹æ©Ÿè™•æ±ºæŒ‰éˆ• (ç´…è‰²)
local HuntBtn = Instance.new("TextButton")
HuntBtn.Parent = ScreenGui
HuntBtn.Size = UDim2.new(0, 80, 0, 80)
HuntBtn.Position = UDim2.new(0.8, 0, 0.45, 0)
HuntBtn.BackgroundColor3 = Color3.fromRGB(0,0,0); HuntBtn.BackgroundTransparency = 0.3
HuntBtn.Text = "è™•æ±º"
HuntBtn.TextColor3 = Color3.fromRGB(255,0,0)
Instance.new("UICorner", HuntBtn).CornerRadius = UDim.new(1,0)
Instance.new("UIStroke", HuntBtn).Color = Color3.fromRGB(255,0,0); Instance.new("UIStroke", HuntBtn).Thickness = 2

-- 3. æ‰‹æ©Ÿéš±å½¢æŒ‰éˆ• (è—è‰²)
local InvisBtn = Instance.new("TextButton")
InvisBtn.Parent = ScreenGui
InvisBtn.Size = UDim2.new(0, 80, 0, 80)
InvisBtn.Position = UDim2.new(0.8, 0, 0.60, 0)
InvisBtn.BackgroundColor3 = Color3.fromRGB(0,0,0); InvisBtn.BackgroundTransparency = 0.3
InvisBtn.Text = "éš±å½¢"
InvisBtn.TextColor3 = Color3.fromRGB(150,150,255)
Instance.new("UICorner", InvisBtn).CornerRadius = UDim.new(1,0)
Instance.new("UIStroke", InvisBtn).Color = Color3.fromRGB(150,150,255); Instance.new("UIStroke", InvisBtn).Thickness = 2

--------------------------------------------------------------------------------
-- 2. Rayfield ä¸»è¦–çª— (å®Œæ•´åŠŸèƒ½)
--------------------------------------------------------------------------------
local Window = Rayfield:CreateWindow({
    Name = "çå¥¶è…³æœ¬ | å…¨åŠŸèƒ½é¢æ¿ v11.0",
    LoadingTitle = "è¼‰å…¥å®Œæ•´ GUI...",
    ConfigurationSaving = { Enabled = false },
    KeySystem = false, 
})

-- ç¶å®šé¸å–®é–‹é—œæŒ‰éˆ•
local UI_Open = true
MenuBtn.MouseButton1Click:Connect(function()
    UI_Open = not UI_Open
    -- Rayfield æ²’æœ‰ç›´æ¥çš„ Toggle å‡½æ•¸ï¼Œé€šå¸¸é€ééš±è— CoreGui è£¡çš„ä»‹é¢
    local r = game.CoreGui:FindFirstChild("Rayfield")
    if r then r.Enabled = UI_Open end
end)

local CombatTab = Window:CreateTab("ğŸ’€ æˆ°é¬¥è¨­å®š", 4483362458)
local FXTab = Window:CreateTab("âœ¨ ç‰¹æ•ˆèª¿æ•´", 4483362458)
local PlayerTab = Window:CreateTab("ğŸƒ è§’è‰²å±¬æ€§", 4483362458)

-- [æˆ°é¬¥é é¢] - ç¢ºä¿æ‰€æœ‰åŠŸèƒ½éƒ½æœ‰æŒ‰éˆ•
CombatTab:CreateSection("1. é–å®šç›®æ¨™")
CombatTab:CreateInput({
    Name = "è¼¸å…¥åå­— (Name)", PlaceholderText = "ç›®æ¨™ID",
    Callback = function(Text)
        Config.TargetName = Text
        local target = FindPlayer(Text)
        if target then
            Config.CurrentTarget = target
            Rayfield:Notify({Title = "å·²é–å®š", Content = target.Name, Duration = 2})
        end
    end,
})

CombatTab:CreateSection("2. è™•æ±ºé–‹é—œ")
CombatTab:CreateToggle({
    Name = "å•Ÿå‹•ï¼šå¼·åˆ¶è™•æ±º (Fling)",
    CurrentValue = false,
    Callback = function(v)
        Config.FlingEnabled = v
        if v then StartFling() else StopFling() end
    end,
})

CombatTab:CreateSection("3. åˆ¤å®šæ“´å¤§ (Hitbox)")
CombatTab:CreateToggle({
    Name = "é–‹å•Ÿå¤§é ­åˆ¤å®š (Hitbox)",
    CurrentValue = false,
    Callback = function(v) Config.Hitbox = v end,
})
CombatTab:CreateSlider({
    Name = "åˆ¤å®šå¤§å° (Size)",
    Range = {5, 50}, Increment = 1, CurrentValue = 15,
    Callback = function(v) Config.HitboxSize = v end,
})

-- [ç‰¹æ•ˆé é¢] - åŠ å›æ‰€æœ‰ç´°é …
FXTab:CreateSection("è¦–è¦ºæ•ˆæœ")
FXTab:CreateToggle({
    Name = "ç¸½é–‹é—œ (Master Switch)", CurrentValue = true,
    Callback = function(v) Config.VisualsEnabled = v; UpdateFX(LocalPlayer.Character, v) end
})
FXTab:CreateToggle({Name = "è¼ªå»“å…‰ (Highlight)", CurrentValue = true, Callback = function(v) Config.Highlight = v end})
FXTab:CreateToggle({Name = "æš—å½±ç²’å­ (Aura)", CurrentValue = true, Callback = function(v) Config.Aura = v end})
FXTab:CreateToggle({Name = "é›·é›» (Lightning)", CurrentValue = true, Callback = function(v) Config.Lightning = v end})
FXTab:CreateToggle({Name = "æˆ°é¬¥è®Šç´… (Aggro Mode)", CurrentValue = true, Callback = function(v) Config.AggroMode = v end})
FXTab:CreateToggle({Name = "é¡¯ç¤ºåå­—/è¡€é‡ (ESP)", CurrentValue = false, Callback = function(v) Config.ESP = v end})

-- [è§’è‰²é é¢]
PlayerTab:CreateSection("ç§»å‹•")
PlayerTab:CreateSlider({Name = "é€Ÿåº¦ (Speed)", Range = {16, 500}, Increment = 5, CurrentValue = 100, Callback = function(v) Config.Speed = v end})
PlayerTab:CreateToggle({Name = "å•Ÿç”¨é€Ÿåº¦", CurrentValue = false, Callback = function(v) Config.SpeedEnabled = v end})
PlayerTab:CreateToggle({Name = "ç©¿ç‰† (Noclip)", CurrentValue = false, Callback = function(v) Config.Noclip = v end})
PlayerTab:CreateSection("éš±è—")
PlayerTab:CreateToggle({
    Name = "å®Œå…¨éš±å½¢ (Invisible)", CurrentValue = false,
    Callback = function(v)
        Config.Invisible = v
        if not v and LocalPlayer.Character then -- æ¢å¾©
             LocalPlayer.Character.Humanoid.DisplayDistanceType = Enum.HumanoidDisplayDistanceType.Viewer
             for _, p in pairs(LocalPlayer.Character:GetDescendants()) do
                 if (p:IsA("BasePart") or p:IsA("Decal")) and p.Name ~= "HumanoidRootPart" then p.Transparency = 0 end
             end
        end
    end
})

--------------------------------------------------------------------------------
-- 3. æ‰‹æ©ŸæŒ‰éˆ•é€£å‹• & å¾ªç’°
--------------------------------------------------------------------------------
HuntBtn.MouseButton1Click:Connect(function()
    Config.FlingEnabled = not Config.FlingEnabled
    if Config.FlingEnabled then HuntBtn.Text="åœæ­¢"; StartFling() else HuntBtn.Text="è™•æ±º"; StopFling() end
end)
InvisBtn.MouseButton1Click:Connect(function()
    Config.Invisible = not Config.Invisible
    if Config.Invisible then InvisBtn.Text="ç¾èº«" else InvisBtn.Text="éš±å½¢" end
end)

RunService.RenderStepped:Connect(function()
    local Char = LocalPlayer.Character
    if not Char or not Char:FindFirstChild("HumanoidRootPart") then return end
    
    -- 1. Fling é–å®š
    if Config.FlingEnabled and Config.CurrentTarget then
        local TChar = Config.CurrentTarget.Character
        if TChar and TChar:FindFirstChild("HumanoidRootPart") then
            Char.HumanoidRootPart.CFrame = TChar.HumanoidRootPart.CFrame -- ç·Šè²¼
        else
            Config.FlingEnabled = false; StopFling()
            Rayfield:Notify({Title="ç›®æ¨™æ¶ˆå¤±", Content="åœæ­¢", Duration=1})
        end
    end
    
    -- 2. éš±å½¢
    if Config.Invisible then
        if Char:FindFirstChild("Humanoid") then Char.Humanoid.DisplayDistanceType = Enum.HumanoidDisplayDistanceType.None end
        for _, v in pairs(Char:GetDescendants()) do
            if v:IsA("BasePart") and v.Name ~= "HumanoidRootPart" then v.Transparency = 1; v.CanCollide = false end
            if v:IsA("Decal") then v.Transparency = 1 end
        end
    end
    
    -- 3. Hitbox & ESP
    if Config.Hitbox then
        for _, p in pairs(Players:GetPlayers()) do
            if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("Head") then
                p.Character.Head.Size = Vector3.new(Config.HitboxSize, Config.HitboxSize, Config.HitboxSize)
                p.Character.Head.Transparency = 0.6; p.Character.Head.CanCollide = false
            end
        end
    end
    
    if Config.ESP then
        for _, p in pairs(Players:GetPlayers()) do
            if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("Head") then
                if not p.Character:FindFirstChild("ZN_ESP") then
                    local bb = Instance.new("BillboardGui", p.Character.Head)
                    bb.Name = "ZN_ESP"; bb.Size = UDim2.new(0,100,0,50); bb.AlwaysOnTop = true
                    local t = Instance.new("TextLabel", bb); t.Size = UDim2.new(1,0,1,0); t.BackgroundTransparency=1
                    t.TextColor3 = Color3.new(1,0,0); t.TextStrokeTransparency=0
                    t.Text = p.Name
                end
            end
        end
    else
        for _, p in pairs(Players:GetPlayers()) do
             if p.Character and p.Character:FindFirstChild("ZN_ESP") then p.Character.ZN_ESP:Destroy() end
        end
    end
end)

RunService.Heartbeat:Connect(function()
    local Char = LocalPlayer.Character
    if not Char then return end
    local Humanoid = Char:FindFirstChild("Humanoid")
    
    if Config.SpeedEnabled and Humanoid then Humanoid.WalkSpeed = Config.Speed end
    if Config.Noclip or Config.FlingEnabled then
        for _, part in pairs(Char:GetChildren()) do
            if part:IsA("BasePart") then part.CanCollide = false end
        end
    end
    if Config.FlingEnabled and Humanoid then Humanoid.Sit = false end
end)

LocalPlayer.CharacterAdded:Connect(function(newChar)
    task.wait(1)
    if Config.VisualsEnabled then UpdateFX(newChar, true) end
end)

Rayfield:Notify({Title = "v11.0 UI ä¿®å¾©", Content = "é»æ“Šå·¦ä¸Šè§’æŒ‰éˆ•å¯é–‹é—œé¸å–®", Duration = 5})
