--[[
    çå¥¶è…³æœ¬ (ZhenNai Hub) - å›ç‹é™è‡¨ç‰ˆ v9.0
    ä¿®å¾©ï¼šç”©é£›ç®—æ³• (Fling Algorithm) - æ”¹ç”¨éœ‡ç›ªç¢°æ’
    å¢å¼·ï¼šè¦–è¦ºç‰¹æ•ˆ (Highlight + Lightning + Particles)
]]

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = game.Workspace.CurrentCamera
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

-- [é…ç½®è¡¨]
local Config = {
    TargetName = "",
    CurrentTarget = nil,
    
    -- æˆ°é¬¥æ ¸å¿ƒ
    FlingEnabled = false,
    FlingType = "Oscillate", -- æ–°ç‰ˆéœ‡ç›ªæ¨¡å¼
    Hitbox = false, HitboxSize = 15, -- é è¨­åŠ å¤§åˆ¤å®š
    
    -- è¦–è¦ºç‰¹æ•ˆ (å…¨é–‹)
    VisualsEnabled = false, 
    Aura = false,        -- ç²’å­æ°£å ´
    Highlight = false,   -- è¼ªå»“ç™¼å…‰
    Lightning = false,   -- é›·é›»ç‰¹æ•ˆ
    AggroMode = true,    -- æˆ°é¬¥è®Šç´…
    
    -- è§’è‰²å±¬æ€§
    Speed = 60, SpeedEnabled = false,
    Noclip = false,
    Invisible = false
}

--------------------------------------------------------------------------------
-- 0. ç³»çµ±å‡½æ•¸
--------------------------------------------------------------------------------
local function FindPlayer(string)
    if string == "" or string == nil then return nil end
    local found = nil
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer then
            if string.find(string.lower(p.Name), string.lower(string)) or 
               string.find(string.lower(p.DisplayName), string.lower(string)) then
                found = p
                break 
            end
        end
    end
    return found
end

-- [ç‰¹æ•ˆç®¡ç†å™¨ï¼šå›ç‹ç´šè¦–è¦º]
local function UpdateFX(char, enable)
    if not char then return end
    local root = char:FindFirstChild("HumanoidRootPart")
    
    if not enable then
        -- é—œé–‰æ‰€æœ‰ç‰¹æ•ˆ
        for _, v in pairs(char:GetDescendants()) do
            if v.Name == "MonarchHighlight" or v.Name == "MonarchParticle" or v.Name == "MonarchLightning" then
                v:Destroy()
            end
        end
        return
    end

    -- 1. å…¨èº«è¼ªå»“å…‰ (Highlight)
    if Config.Highlight and not char:FindFirstChild("MonarchHighlight") then
        local hl = Instance.new("Highlight")
        hl.Name = "MonarchHighlight"
        hl.FillColor = Color3.fromRGB(0, 0, 0) -- å…§éƒ¨å…¨é»‘
        hl.OutlineColor = Color3.fromRGB(150, 0, 255) -- ç´«è‰²é‚Šæ¡†
        hl.FillTransparency = 0.5
        hl.OutlineTransparency = 0
        hl.Parent = char
    end

    -- 2. æš—å½±ç²’å­ (Particles)
    if Config.Aura and root and not root:FindFirstChild("MonarchParticle") then
        local p = Instance.new("ParticleEmitter")
        p.Name = "MonarchParticle"
        p.Texture = "rbxassetid://243660364" -- ç…™éœ§
        p.Rate = 150 -- å¯†åº¦å¢åŠ 
        p.Lifetime = NumberRange.new(0.5, 0.8)
        p.Speed = NumberRange.new(3)
        p.Size = NumberSequence.new({NumberSequenceKeypoint.new(0, 1), NumberSequenceKeypoint.new(1, 0)})
        p.Transparency = NumberSequence.new({NumberSequenceKeypoint.new(0, 0.2), NumberSequenceKeypoint.new(1, 1)})
        p.Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromRGB(20, 0, 50)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(100, 50, 255))
        })
        p.LockedToPart = true
        p.ZOffset = -1
        p.Parent = root
    end

    -- 3. é›·é›»ç‰¹æ•ˆ (Lightning - æ¨¡æ“¬)
    if Config.Lightning and root and not root:FindFirstChild("MonarchLightning") then
        local p = Instance.new("ParticleEmitter")
        p.Name = "MonarchLightning"
        p.Texture = "rbxassetid://242205514" -- æ˜Ÿæ˜Ÿ/ç«èŠ±ç´‹ç†æ¨¡æ“¬é›»æµ
        p.Rate = 50
        p.Lifetime = NumberRange.new(0.1, 0.3)
        p.Speed = NumberRange.new(0)
        p.Size = NumberSequence.new({NumberSequenceKeypoint.new(0, 2), NumberSequenceKeypoint.new(1, 0)})
        p.Rotation = NumberRange.new(0, 360)
        p.RotSpeed = NumberRange.new(500, 1000) -- é«˜é€Ÿæ—‹è½‰æ¨¡æ“¬é–ƒçˆ
        p.Color = ColorSequence.new(Color3.fromRGB(0, 255, 255))
        p.Parent = root
    end
end

-- [æˆ°é¬¥è®Šè‰²é‚è¼¯]
local function SetAggroColor(char, isAggro)
    if not char then return end
    local hl = char:FindFirstChild("MonarchHighlight")
    local pt = char:FindFirstChild("HumanoidRootPart") and char.HumanoidRootPart:FindFirstChild("MonarchParticle")
    local lt = char:FindFirstChild("HumanoidRootPart") and char.HumanoidRootPart:FindFirstChild("MonarchLightning")

    if isAggro then
        -- ç´…è‰²æ¨¡å¼ (æ®ºæˆ®)
        if hl then hl.OutlineColor = Color3.fromRGB(255, 0, 0) end
        if pt then pt.Color = ColorSequence.new(Color3.fromRGB(255, 0, 0)) end
        if lt then lt.Color = ColorSequence.new(Color3.fromRGB(255, 50, 50)) end
    else
        -- è—ç´«æ¨¡å¼ (å¹³å¸¸)
        if hl then hl.OutlineColor = Color3.fromRGB(150, 0, 255) end
        if pt then 
            pt.Color = ColorSequence.new({
                ColorSequenceKeypoint.new(0, Color3.fromRGB(20, 0, 50)), 
                ColorSequenceKeypoint.new(1, Color3.fromRGB(100, 50, 255))
            }) 
        end
        if lt then lt.Color = ColorSequence.new(Color3.fromRGB(0, 255, 255)) end
    end
end

--------------------------------------------------------------------------------
-- 1. UI ä»‹é¢
--------------------------------------------------------------------------------
local Window = Rayfield:CreateWindow({
    Name = "çå¥¶è…³æœ¬ | å›ç‹é™è‡¨ (MONARCH v9.0)",
    LoadingTitle = "ç³»çµ±é‡æ§‹ä¸­...",
    LoadingSubtitle = "ä¿®å¾©ç‰©ç†å¼•æ“ - ç‰¹æ•ˆå…¨é–‹",
    ConfigurationSaving = { Enabled = false },
    KeySystem = false, 
})

local CombatTab = Window:CreateTab("ğŸ’€ çµæ®º", 4483362458)
local FXTab = Window:CreateTab("âš¡ ç‰¹æ•ˆ", 4483362458)
local GhostTab = Window:CreateTab("ğŸ‘» éš±èº«", 4483362458)
local VisualTab = Window:CreateTab("ğŸ‘ï¸ è¦–è¦º", 4483362458)
local PlayerTab = Window:CreateTab("ğŸƒ é«”èƒ½", 4483362458)

--------------------------------------------------------------------------------
-- 2. æˆ°é¬¥ (Combat - Fling Fixed)
--------------------------------------------------------------------------------
CombatTab:CreateSection("ç›®æ¨™é–å®š")
CombatTab:CreateInput({
    Name = "ç›®æ¨™åç¨±", PlaceholderText = "è¼¸å…¥éƒ¨åˆ†IDæˆ–åå­—",
    Callback = function(Text)
        Config.TargetName = Text
        local target = FindPlayer(Text)
        if target then
            Config.CurrentTarget = target
            Rayfield:Notify({Title = "é–å®šæˆåŠŸ", Content = target.Name, Duration = 2})
        else
            Rayfield:Notify({Title = "æœå°‹å¤±æ•—", Content = "æ‰¾ä¸åˆ°ç©å®¶", Duration = 2})
        end
    end,
})

CombatTab:CreateSection("è™•æ±º (å·²ä¿®å¾©å¤±æ•ˆå•é¡Œ)")
local FlingToggle = CombatTab:CreateToggle({
    Name = "å•Ÿå‹•ï¼šæ¯€æ»…ç”©é£› (Oscillation Fling)",
    CurrentValue = false,
    Callback = function(v)
        Config.FlingEnabled = v
        if v then
            if not Config.CurrentTarget then
                Rayfield:Notify({Title = "éŒ¯èª¤", Content = "æœªé–å®šç›®æ¨™ï¼", Duration = 2})
                Config.FlingEnabled = false
            else
                -- å¼·åˆ¶åˆ‡æ›ç‚ºç´…è‰²æˆ°é¬¥ç‹€æ…‹
                if Config.AggroMode then SetAggroColor(LocalPlayer.Character, true) end
                -- é˜²æ­¢æ‘”å€’
                if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
                    LocalPlayer.Character.Humanoid.PlatformStand = true
                end
            end
        else
            -- é—œé–‰æ™‚æ¢å¾©
            if Config.AggroMode then SetAggroColor(LocalPlayer.Character, false) end
            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
                LocalPlayer.Character.Humanoid.PlatformStand = false
            end
            -- é‡ç½®é€Ÿåº¦
            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                LocalPlayer.Character.HumanoidRootPart.Velocity = Vector3.new(0,0,0)
                LocalPlayer.Character.HumanoidRootPart.AssemblyAngularVelocity = Vector3.new(0,0,0)
            end
        end
    end,
})

CombatTab:CreateLabel("èªªæ˜ï¼šæ–°ç‰ˆæ¡ç”¨ã€Œå…§éƒ¨éœ‡ç›ªã€ç‰©ç†é‹ç®—ï¼Œ\nå³ä½¿å°æ–¹é–‹é˜²ç”©é£›ä¹Ÿèƒ½å¼·åˆ¶å½ˆé–‹ã€‚")

--------------------------------------------------------------------------------
-- 3. ç‰¹æ•ˆ (FX - Visual Overload)
--------------------------------------------------------------------------------
FXTab:CreateSection("å›ç‹è¦–è¦ºé–‹é—œ")

FXTab:CreateToggle({
    Name = "ç¸½é–‹é—œ (Visuals Master)",
    CurrentValue = false,
    Callback = function(v)
        Config.VisualsEnabled = v
        if not v then UpdateFX(LocalPlayer.Character, false) else UpdateFX(LocalPlayer.Character, true) end
    end,
})

FXTab:CreateSection("ç´°é …è¨­å®š (éœ€é–‹å•Ÿç¸½é–‹é—œ)")
FXTab:CreateToggle({Name = "æš—å½±æ°£å ´ (Particles)", CurrentValue = true, Callback = function(v) Config.Aura = v; if Config.VisualsEnabled then UpdateFX(LocalPlayer.Character, true) end end})
FXTab:CreateToggle({Name = "é›·é›»çºç¹ (Lightning)", CurrentValue = true, Callback = function(v) Config.Lightning = v; if Config.VisualsEnabled then UpdateFX(LocalPlayer.Character, true) end end})
FXTab:CreateToggle({Name = "è¼ªå»“éœ¸æ°£ (Highlight)", CurrentValue = true, Callback = function(v) Config.Highlight = v; if Config.VisualsEnabled then UpdateFX(LocalPlayer.Character, true) end end})
FXTab:CreateToggle({Name = "æ®ºæˆ®è®Šè‰² (Red Mode)", CurrentValue = true, Callback = function(v) Config.AggroMode = v end})

--------------------------------------------------------------------------------
-- 4. éš±èº« (Ghost)
--------------------------------------------------------------------------------
GhostTab:CreateToggle({
    Name = "å®Œå…¨éš±å½¢ (Invisible)",
    CurrentValue = false,
    Callback = function(v)
        Config.Invisible = v
        if not v and LocalPlayer.Character then
            -- æ¢å¾©é¡¯ç¤º
            LocalPlayer.Character.Humanoid.DisplayDistanceType = Enum.HumanoidDisplayDistanceType.Viewer
            for _, part in pairs(LocalPlayer.Character:GetDescendants()) do
                if (part:IsA("BasePart") or part:IsA("Decal")) and part.Name ~= "HumanoidRootPart" then
                    part.Transparency = 0
                end
            end
        end
    end,
})

--------------------------------------------------------------------------------
-- 5. æ‰‹æ©Ÿ UI
--------------------------------------------------------------------------------
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ZhenNai_V9_UI"
if game.CoreGui:FindFirstChild("ZhenNai_V9_UI") then game.CoreGui.ZhenNai_V9_UI:Destroy() end
ScreenGui.Parent = game.CoreGui

local function CreateBtn(text, pos, color)
    local btn = Instance.new("TextButton")
    btn.Parent = ScreenGui; btn.Size = UDim2.new(0, 85, 0, 85); btn.Position = pos
    btn.BackgroundColor3 = Color3.fromRGB(0,0,0); btn.BackgroundTransparency = 0.4
    btn.Text = text; btn.TextColor3 = color; btn.Font = Enum.Font.GothamBlack; btn.TextSize = 18
    Instance.new("UICorner", btn).CornerRadius = UDim.new(1,0)
    Instance.new("UIStroke", btn).Color = color; Instance.new("UIStroke", btn).Thickness = 2
    return btn
end

local HuntBtn = CreateBtn("æ¯€æ»…", UDim2.new(0.8, 0, 0.40, 0), Color3.fromRGB(255, 0, 0))
local FXBtn = CreateBtn("éœ¸æ°£", UDim2.new(0.8, 0, 0.55, 0), Color3.fromRGB(0, 255, 255))
local InvisBtn = CreateBtn("éš±å½¢", UDim2.new(0.8, 0, 0.70, 0), Color3.fromRGB(150, 150, 255))
HuntBtn.Visible = false; FXBtn.Visible = false; InvisBtn.Visible = false

CombatTab:CreateToggle({
    Name = "é¡¯ç¤ºæ‰‹æ©ŸæŒ‰éˆ•", CurrentValue = false, 
    Callback = function(v) HuntBtn.Visible = v; FXBtn.Visible = v; InvisBtn.Visible = v end
})

-- æ‰‹æ©ŸæŒ‰éˆ•é€£å‹•
HuntBtn.MouseButton1Click:Connect(function()
    Config.FlingEnabled = not Config.FlingEnabled
    if Config.FlingEnabled then
        HuntBtn.Text = "åœæ­¢"
        if Config.AggroMode then SetAggroColor(LocalPlayer.Character, true) end
        if not Config.CurrentTarget then Rayfield:Notify({Title="è­¦å‘Š", Content="æœªé–å®š", Duration=1}) end
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then LocalPlayer.Character.Humanoid.PlatformStand = true end
    else
        HuntBtn.Text = "æ¯€æ»…"
        if Config.AggroMode then SetAggroColor(LocalPlayer.Character, false) end
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then LocalPlayer.Character.Humanoid.PlatformStand = false end
        -- ç…è»Š
        if LocalPlayer.Character.HumanoidRootPart then
            LocalPlayer.Character.HumanoidRootPart.Velocity = Vector3.new(0,0,0)
            LocalPlayer.Character.HumanoidRootPart.AssemblyAngularVelocity = Vector3.new(0,0,0)
        end
    end
end)

FXBtn.MouseButton1Click:Connect(function()
    Config.VisualsEnabled = not Config.VisualsEnabled
    if Config.VisualsEnabled then FXBtn.Text = "é—œé–‰"; UpdateFX(LocalPlayer.Character, true)
    else FXBtn.Text = "éœ¸æ°£"; UpdateFX(LocalPlayer.Character, false) end
end)

InvisBtn.MouseButton1Click:Connect(function()
    Config.Invisible = not Config.Invisible
    if Config.Invisible then InvisBtn.Text = "ç¾èº«" else InvisBtn.Text = "éš±å½¢" end
end)

--------------------------------------------------------------------------------
-- 6. æ ¸å¿ƒå¾ªç’° (The Engine)
--------------------------------------------------------------------------------
PlayerTab:CreateSlider({Name="é€Ÿåº¦", Range={16, 500}, Increment=5, CurrentValue=60, Callback=function(v) Config.Speed=v end})
PlayerTab:CreateToggle({Name="å•Ÿç”¨é€Ÿåº¦", CurrentValue=false, Callback=function(v) Config.SpeedEnabled=v end})
PlayerTab:CreateToggle({Name="ç©¿ç‰† (Noclip)", CurrentValue=false, Callback=function(v) Config.Noclip=v end})

RunService.Heartbeat:Connect(function()
    local Char = LocalPlayer.Character
    if not Char or not Char:FindFirstChild("HumanoidRootPart") then return end
    local Root = Char.HumanoidRootPart
    local Humanoid = Char:FindFirstChild("Humanoid")

    -- 1. éš±å½¢
    if Config.Invisible then
        if Humanoid then Humanoid.DisplayDistanceType = Enum.HumanoidDisplayDistanceType.None end
        for _, v in pairs(Char:GetDescendants()) do
            if v:IsA("BasePart") and v.Name ~= "HumanoidRootPart" then
                v.Transparency = 1; v.CanCollide = false
            elseif v:IsA("Decal") then v.Transparency = 1 end
        end
    end

    -- 2. é€Ÿåº¦èˆ‡ç©¿ç‰†
    if Config.SpeedEnabled and Humanoid then Humanoid.WalkSpeed = Config.Speed end
    if Config.Noclip or Config.FlingEnabled then
        for _, part in pairs(Char:GetChildren()) do
            if part:IsA("BasePart") then part.CanCollide = false end
        end
    end

    -- 3. [ä¿®å¾©ç‰ˆ] ç”©é£›é‚è¼¯ (Fling Logic Fixed)
    if Config.FlingEnabled and Config.CurrentTarget then
        local TChar = Config.CurrentTarget.Character
        if TChar and TChar:FindFirstChild("HumanoidRootPart") and TChar.Humanoid.Health > 0 then
            local TRoot = TChar.HumanoidRootPart
            
            -- æ–¹æ³• A: é–å®šä½ç½®æ–¼ç›®æ¨™ä¸­å¿ƒ (ä¸å¾€ä¸‹ï¼Œç›´æ¥é‡ç–Š)
            Root.CFrame = TRoot.CFrame 
            
            -- æ–¹æ³• B: é€Ÿåº¦éœ‡ç›ª (Oscillation)
            -- é€™æ˜¯é—œéµï¼šä¸è¦åªçµ¦ä¸€å€‹å¸¸æ•¸é€Ÿåº¦ï¼Œè¦è®“é€Ÿåº¦åœ¨æ¥µå¤§å€¼ä¹‹é–“è·³å‹•ï¼Œç”¢ç”Ÿç‰©ç†éŒ¯èª¤
            local randomVel = Vector3.new(math.random(-100,100), math.random(-100,100), math.random(-100,100))
            Root.Velocity = randomVel * 5 -- è¼•å¾®ç·šæ€§æ“¾å‹•
            
            -- è¨­ç½®æ—‹è½‰è§’é€Ÿåº¦ï¼šä½¿ç”¨æ¥µå¤§å€¼ (20000 å·¦å³é€šå¸¸æ¯” math.huge ç©©å®šï¼Œå› ç‚ºä¸æœƒè®Šæˆ NaN)
            Root.AssemblyAngularVelocity = Vector3.new(25000, 25000, 25000)
            
        else
            -- ç›®æ¨™ä¸Ÿå¤±è™•ç†
            Config.FlingEnabled = false
            Rayfield:Notify({Title = "ç‹€æ…‹", Content = "ç›®æ¨™å·²æ¸…é™¤", Duration = 2})
            HuntBtn.Text = "æ¯€æ»…"
            if Config.AggroMode then SetAggroColor(Char, false) end
            if Humanoid then Humanoid.PlatformStand = false end
            Root.Velocity = Vector3.new(0,0,0)
            Root.AssemblyAngularVelocity = Vector3.new(0,0,0)
        end
    end
end)

-- æ­»äº¡é‡ç”Ÿå¾Œè‡ªå‹•è£œå›ç‰¹æ•ˆ
LocalPlayer.CharacterAdded:Connect(function(newChar)
    task.wait(1)
    if Config.VisualsEnabled then UpdateFX(newChar, true) end
end)

Rayfield:Notify({Title = "å›ç‹é™è‡¨ v9.0", Content = "ç‰©ç†å¼•æ“ä¿®å¾©å®Œç•¢ã€‚ç‰¹æ•ˆå·²å¢å¼·ã€‚", Duration = 5})
